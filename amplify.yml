version: 1
frontend:
  phases:
    preBuild:
      commands:
        # Use Yarn with --frozen-lockfile for fast, deterministic builds in CI.
        - yarn install --frozen-lockfile
        - echo "NEXT_PUBLIC_BUILD_ID=${AWS_COMMIT_ID:-$(date +%s)}" >> .env.production
    build:
      commands:
        - echo "Building Next.js application..."
        - yarn build
  artifacts:
    baseDirectory: .next
    files:
      - "**/*"
  cache:
    paths:
      - node_modules/**/*
      - .next/cache/**/*
      - .yarn/cache/**/*

  # The 'customHeaders' section has been removed.
  # Security headers (CSP, HSTS, etc.) and caching policies are now managed
  # within the Next.js application via `middleware.ts`. This is the
  # recommended approach as it centralizes logic and supports dynamic headers.
# Environment variables should be set in the Amplify Console for better security.
# Go to: App settings > Environment variables
# Recommended variables:
# NODE_ENV: production
# NEXT_TELEMETRY_DISABLED: 1
