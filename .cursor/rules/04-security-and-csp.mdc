---
globs: middleware.ts, app/layout.tsx, app/GoogleScripts.tsx
alwaysApply: false
---

### Security: CSP and nonce usage (middleware-driven)

- Nonce source: `middleware.ts` generates `x-nonce`; pages/components must read from `headers()` and pass to Script/JSON-LD.
- CSP: strict nonce-based with `'strict-dynamic'`; no inline scripts without nonce.
- Placement: In layouts/pages, read nonce once and pass down:

```
const headersList = await headers();
const nonce = headersList.get('x-nonce') || '';
```

- Scripts: Load GA/Ads/Sentry afterInteractive and with `nonce`.
- Headers: Security headers set in `middleware.ts`; do not duplicate in Next `headers()` config.
- Frames/Workers: Respect `frame-src`, `worker-src` limitations.
