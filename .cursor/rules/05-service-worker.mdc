---
globs: public/sw-template.js, public/sw.js, scripts/generate-sw.mjs, proxy.ts
alwaysApply: false
---

### Service Worker workflow

- **Template only**: Edit `public/sw-template.js`; never hand-edit generated `public/sw.js`.
- **Generation**: `scripts/generate-sw.mjs` replaces `{{API_ORIGIN}}` with origin from env and writes `public/sw.js`.
- **When to run**: Run `yarn prebuild` whenever `public/sw-template.js` changes (before `yarn dev` or `yarn build`). Env-specific builds (`yarn build:development|staging|production`) already run `prebuild`; base `yarn build` does not.
- **Caching updates**: Modify logic via template, regenerate; keep Workbox 7 patterns.
- **Proxy**: Special handling of `/sw.js` headers is in `proxy.ts` (Next.js 16 middleware replacement).
