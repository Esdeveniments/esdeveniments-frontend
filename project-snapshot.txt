<?xml version='1.0' encoding='utf-8'?>
<source type="github_repository"><commit>unknown</commit><file name=".eslintrc.json">{ "plugins": ["@typescript-eslint"], "extends": [ "eslint:recommended", "next", "next/core-web-vitals", "plugin:@typescript-eslint/recommended" ], "rules": { "no-unused-vars": "warn", "no-undef": "error", "no-debugger": "error", "react/react-in-jsx-scope": }, "env": { "es6": true, "browser": true, "node": true, "jest": true }, "overrides": [ { "files": ["public/sw.js", "public/sw-template.js"], "env": { "serviceworker": true }, "globals": { "workbox": "readonly", "importscripts": "readonly", "caches": "readonly", "self": "readonly" }, "rules": { "no-undef": } }, { "files": ["*.ts", "*.tsx"], "rules": { "no-undef": } }, { "files": [ "components/**/*.{ts,tsx,js,jsx}", "app/**/*.{ts,tsx,js,jsx}", "store.ts", "utils/**/*.{ts,tsx,js,jsx}" ], "rules": { "no-restricted-syntax": [ "error", { "selector": "tstypealiasdeclaration", "message": declare types outside /types directory. centralize type aliases /types." }, { "selector": "tsinterfacedeclaration", "message": declare interfaces outside /types directory. centralize interfaces /types." } ] } }, { "files": ["types/**/*.ts"], "rules": { "@typescript-eslint/no-unused-vars": "error", "no-restricted-syntax": [ "error", { "selector": "tsinterfacedeclaration[declaration.name='navigationitem']:not(:first-of-type)", "message": "navigationitem interface already defined. use canonical version types/common.ts." }, { "selector": "tsinterfacedeclaration[declaration.name='sociallinks']:not(:first-of-type)", "message": "sociallinks interface already defined. use canonical version types/common.ts." }, { "selector": "tsinterfacedeclaration[declaration.name='eventprops']:not(:first-of-type)", "message": "eventprops interface already defined. use canonical version types/common.ts." }, { "selector": "tsinterfacedeclaration[declaration.name='citysummaryresponsedto']:not(:first-of-type)", "message": "citysummaryresponsedto interface already defined. use canonical version types/api/city.ts." } ] } } ] }</file><file name=".yarnrc.yml">nodelinker: node-modules yarnpath: .yarn/releases/yarn-4.9.1.cjs</file><file name="README.md">[next.js](https://nextjs.org/) project bootstrapped [`create-next-app`](https://github.com/vercel/next.js/tree/canary/packages/create-next-app). ## getting started first, run development server: ```bash npm run dev # yarn dev ``` open [http://localhost:3000](http://localhost:3000) browser see result. start editing page modifying `pages/index.js`. page auto-updates edit file. [api routes](https://nextjs.org/docs/api-routes/introduction) accessed [http://localhost:3000/api/hello](http://localhost:3000/api/hello). endpoint edited `pages/api/hello.js`. `pages/api` directory mapped `/api/*`. files directory treated [api routes](https://nextjs.org/docs/api-routes/introduction) instead react pages. ## learn learn next.js, take look following resources: - [next.js documentation](https://nextjs.org/docs) - learn next.js features api. - [learn next.js](https://nextjs.org/learn) - interactive next.js tutorial. check next.js github repository](https://github.com/vercel/next.js/) - feedback contributions welcome! ## deploy vercel easiest way deploy next.js app use [vercel platform](https://vercel.com/new?utm_medium=default-template&amp;filter=next.js&amp;utm_source=create-next-app&amp;utm_campaign=create-next-app-readme) creators next.js. check [next.js deployment documentation](https://nextjs.org/docs/deployment) details.</file><file name="amplify.yml">version: 1 frontend: phases: prebuild: commands: # ensure correct node yarn (berry) versions - nvm install 20 &amp;&amp; nvm use 20 - corepack enable - corepack prepare yarn@4.9.1 --activate - yarn --version # use yarn 4 immutable installs fast, deterministic builds ci - yarn install --immutable # remove existing keys, write single, up-to-date copy - sed '/^next_public_build_id=/d' .env.production 2&gt;/dev/null || true - sed '/^next_telemetry_disabled=/d' .env.production 2&gt;/dev/null || true - | { echo "next_public_build_id=${aws_commit_id:-$(date echo "next_telemetry_disabled=1" } &gt;&gt; .env.production build: commands: - echo "building next.js application..." - test -f scripts/generate-sw.mjs || { echo "generate-sw.mjs missing"; exit 1; } - node scripts/generate-sw.mjs - yarn build artifacts: basedirectory: .next files: - "**/*" cache: paths: - node_modules/**/* - .next/cache/**/* - .yarn/cache/**/* # static asset caching configured optimal performance. # security headers dynamic content managed middleware.ts. # assets using getversionedurl() longer cache times. customheaders: # service worker: avoid caching allow root scope - pattern: "/sw.js" headers: - key: cache-control value: "no-cache, no-store, must-revalidate" - key: service-worker-allowed value: "/" # next.js built assets - automatically hashed, safe long cache - pattern: "/_next/static/**" headers: - key: cache-control value: "public, max-age=31536000, immutable" # next.js optimized images - 1 year cache (critical performance) - pattern: "/_next/image*" headers: - key: cache-control value: "public, max-age=31536000, immutable" # css files - safe long cache since /styles/non-critical.css uses getversionedurl - pattern: "/styles/**" headers: - key: cache-control value: "public, max-age=31536000, immutable" - key: content-type value: "text/css; charset=utf-8" # font files - longer cache cors headers cross-origin loading - pattern: "/static/fonts/**" headers: - key: cache-control value: "public, max-age=31536000, immutable" - key: access-control-allow-origin value: "*" - key: cross-origin-resource-policy value: "cross-origin" # static assets - conservative since may use getversionedurl - pattern: "/static/**" headers: - key: cache-control value: "public, max-age=2592000" # 30 days # static images user uploads) - conservative approach # separate patterns common image extensions (brace expansion supported) - pattern: "/static/**/*.png" headers: - key: cache-control value: "public, max-age=2592000" # 30 days - pattern: "/static/**/*.jpg" headers: - key: cache-control value: "public, max-age=2592000" # 30 days - pattern: "/static/**/*.jpeg" headers: - key: cache-control value: "public, max-age=2592000" # 30 days - pattern: "/static/**/*.gif" headers: - key: cache-control value: "public, max-age=2592000" # 30 days - pattern: "/static/**/*.webp" headers: - key: cache-control value: "public, max-age=2592000" # 30 days - pattern: "/static/**/*.svg" headers: - key: cache-control value: "public, max-age=2592000" # 30 days - pattern: "/static/**/*.ico" headers: - key: cache-control value: "public, max-age=2592000" # 30 days # fonts - longer cache since rarely change (avoid brace expansion) - pattern: "/**/*.woff" headers: - key: cache-control value: "public, max-age=31536000" # 1 year - pattern: "/**/*.woff2" headers: - key: cache-control value: "public, max-age=31536000" # 1 year - pattern: "/**/*.ttf" headers: - key: cache-control value: "public, max-age=31536000" # 1 year - pattern: "/**/*.eot" headers: - key: cache-control value: "public, max-age=31536000" # 1 year # next.js pages - enable back/forward cache better performance # pattern matches html pages routes without file extensions - pattern: "/*" headers: - key: cache-control value: "public, max-age=0, s-maxage=3600, stale-while-revalidate=86400" # api routes - cors headers functionality (middleware excludes - pattern: "/api/**" headers: - key: access-control-allow-origin value: "https://esdeveniments.cat" - key: access-control-allow-methods value: "get,options,patch,delete,post,put" - key: access-control-allow-headers value: "x-csrf-token, x-requested-with, accept, accept-version, content-length, content-md5, content-type, date, x-api-version" - key: vary value: "origin" - key: cache-control value: "public, max-age=3600" # 1 hour - conservative api responses # environment variables set amplify console better security. # go app settings &gt; environment variables # recommended variables: # node_env: production # next_telemetry_disabled: 1</file><file name="jsconfig.json">{ "compileroptions": { "paths": { "@store": ["./store.js"], "@app/*": ["./app/*"], "@components/*": ["./components/*"], "@styles/*": ["./styles/*"], "@content/*": ["./content/*"], "@utils/*": ["./utils/*"], "@lib/*": ["./lib/*"], "@config/*": ["./config/*"], "@public/*": ["./public/*"], "@types/*": ["./types/*"] }, "types": ["./types/react-datepicker.d.ts", "./types/navigator.d.ts"] } }</file><file name="middleware.ts">import { nextrequest, nextresponse } "next/server"; import { getapiorigin } "@utils/api-helpers"; import { validatetimestamp, buildstringtosign, verifyhmacsignature, } "@utils/hmac"; const isdev = process.env.node_env !== "production"; function getcsp(nonce: string) { const apiorigin = getapiorigin(); const cspdirectives = { "default-src": ["'self'"], "script-src": [ "'self'", `'nonce-${nonce}'`, "'strict-dynamic'", isdev ? "'unsafe-eval'" : "", isdev ? "localhost:*" : "", isdev ? "127.0.0.1:*" : "", ], "style-src": ["'self'", "'unsafe-inline'"], "connect-src": [ "'self'", apiorigin, "https:", isdev ? "wss:" : "", isdev ? "ws:" : "", isdev ? "localhost:*" : "", isdev ? "127.0.0.1:*" : "", ], "img-src": ["'self'", "data:", "https:"], "font-src": ["'self'"], "frame-src": ["'self'", "https:"], "worker-src": ["'self'", "blob:"], "object-src": ["'none'"], "base-uri": ["'self'"], "form-action": ["'self'"], "frame-ancestors": ["'self'"], }; return object.entries(cspdirectives) .map(([key, value]) =&gt; `${key} ${value.filter(boolean).join(" ")}`) .join("; "); } export async function middleware(request: nextrequest) { const { pathname } = request.nexturl; (pathname.startswith("/api/")) { const hmac = request.headers.get("x-hmac"); const timestamp = request.headers.get("x-timestamp"); const contenttype = request.headers.get("content-type") || ""; let requestbody = ""; (!process.env.hmac_secret) { console.error("hmac_secret configured server."); return new nextresponse("internal server error", { status: 500 }); } (!contenttype.tolowercase().startswith("multipart/form-data")) { try { requestbody = await request.clone().text(); } catch (error) { console.error("could read request body middleware:", error); return new nextresponse("bad request: unable read request body", { status: 400, }); } } (!hmac || !timestamp) { return new nextresponse("unauthorized", { status: 401, }); } (!validatetimestamp(timestamp)) { return new nextresponse("unauthorized", { status: 401, }); } const stringtosign = buildstringtosign( requestbody, timestamp, pathname + request.nexturl.search, request.method ); const signatureisvalid = await verifyhmacsignature(stringtosign, hmac); (!signatureisvalid) { return new nextresponse(`unauthorized`, { status: 401, }); } return nextresponse.next(); } (pathname === "/sw.js") { const response = nextresponse.next(); response.headers.set( "cache-control", "no-cache, no-store, must-revalidate" ); response.headers.set("service-worker-allowed", "/"); return response; } const segments = pathname.split("/").filter(boolean); ( (segments.length === 3 || segments.length === 2) &amp;&amp; segments[1] === "tots" ) { const newpath = segments.length === 3 ? `/${segments[0]}/${segments[2]}` : `/${segments[0]}`; const searchparams = request.nexturl.searchparams.tostring(); const finalurl = searchparams ? `${newpath}?${searchparams}` : newpath; return nextresponse.redirect(new url(finalurl, request.url), 301); } const nonce = crypto.randomuuid(); const csp = getcsp(nonce); const requestheaders = new headers(request.headers); requestheaders.set("x-nonce", nonce); requestheaders.set("x-pathname", pathname); const response = nextresponse.next({ request: { headers: requestheaders, }, }); response.headers.set("content-security-policy", csp); response.headers.set( "strict-transport-security", "max-age=63072000; includesubdomains; preload" ); response.headers.set("x-content-type-options", "nosniff"); response.headers.set("x-frame-options", "sameorigin"); response.headers.set("referrer-policy", "strict-origin-when-cross-origin"); response.headers.set( "permissions-policy", "camera=(), microphone=(), geolocation=(self)" ); return response; } export const config = { matcher: [ "/((?!_next|favicon.ico|robots.txt|sitemap\\.xml|ads.txt|static|styles).*)", ], };</file><file name="next-sitemap.config.js">const siteurl = process.env.node_env !== "production" ? "http://localhost:3000" : process.env.next_public_vercel_env === "preview" || process.env.next_public_vercel_env === "development" ? "https://esdeveniments.vercel.app" : "https://www.esdeveniments.cat"; module.exports = { siteurl, generatesitemap: false, exclude: [ "api", "_app.js", "_document.js", "404.js", "_error.js", "sitemap.xml.js", "server-sitemap.xml", "server-sitemap.xml.js", "/server-sitemap.xml", "/server-sitemap.xml.js", "server-news-sitemap.xml", "/server-news-sitemap.xml", "server-place-sitemap.xml", "/server-place-sitemap.xml", "server-google-news-sitemap.xml", "/server-google-news-sitemap.xml", "rss.xml", "/rss.xml", ".next", "___next_launcher.js", "___vc", "node_modules", "package.json", "e/[eventid]", ], generaterobotstxt: true, robotstxtoptions: { policies: [ { useragent: "*", disallow: ["/404"], }, { useragent: "*", allow: "/" }, ], additionalsitemaps: [ `${siteurl}/sitemap.xml`, `${siteurl}/server-sitemap.xml`, `${siteurl}/server-news-sitemap.xml`, `${siteurl}/server-place-sitemap.xml`, `${siteurl}/server-google-news-sitemap.xml`, ], }, transform: async (config, path) =&gt; { // use path default key return { loc: path, changefreq: config.changefreq, priority: config.priority, lastmod: config.autolastmod ? new date().toisostring() : undefined, }; }, };</file><file name="next-sitemap.d.ts">declare module 'next-sitemap' { export const getserversidesitemaplegacy: export type isitemapfield = }</file><file name="next.config.js">const { withsentryconfig } = require("@sentry/nextjs"); /** @type {import('next').nextconfig} */ const nextconfig = { // --- core settings --- reactstrictmode: true, poweredbyheader: false, compress: true, productionbrowsersourcemaps: false, // --- experimental features --- experimental: { scrollrestoration: true, reactcompiler: true, // react compiler experimental }, // --- optimizations --- compiler: { removeconsole: process.env.node_env === "production", }, // --- image optimization --- images: { // important: whitelist specific domains load images // using wildcards security risk. remotepatterns: [ { protocol: "https", hostname: "**" }, { protocol: "http", hostname: "**" }, ], devicesizes: [480, 640, 768, 1024, 1280, 1600, 1920], imagesizes: [16, 32, 48, 64, 96, 128, 256, 384], formats: ["image/avif", "image/webp"], minimumcachettl: 86400, }, // `headers` block removed. // security caching headers managed dynamically `middleware.ts`. // recommended approach implementing strict csp nonces. // --- redirects --- async redirects() { return []; }, }; // enable uploads auth token present. otherwise skip network calls avoid build failures. const sentryuploadsenabled = boolean(process.env.sentry_auth_token); const sentrywebpackpluginoptions = { silent: true, org: "esdeveniments", project: "javascript-nextjs", widenclientfileupload: true, transpileclientsdk: true, // prevent original sources appearing devtools production hidesourcemaps: true, // skip sentry network operations auth token configured (e.g., amplify/gha builds) dryrun: !sentryuploadsenabled, disablelogger: true, automaticvercelmonitors: true, }; module.exports = withsentryconfig(nextconfig, sentrywebpackpluginoptions);</file><file name="package.json">{ "private": true, "scripts": { "analyze": "cross-env analyze=true next build", "analyze:server": "cross-env bundle_analyze=server next build", "analyze:browser": "cross-env bundle_analyze=browser next build", "vercel-build": "yarn run prebuild &amp;&amp; next build &amp;&amp; yarn run postbuild", "dev": "yarn run prebuild &amp;&amp; next dev", "build": "yarn run prebuild &amp;&amp; next build", "prebuild": "node scripts/generate-sw.mjs", "build:development": "node_env=development env-cmd -f .env.development yarn run prebuild &amp;&amp; env-cmd -f .env.development next build", "start:development": "env-cmd -f .env.development next start", "build:staging": "node_env=staging env-cmd -f .env.staging yarn run prebuild &amp;&amp; env-cmd -f .env.staging next build", "start:staging": "env-cmd -f .env.staging next start", "build:production": "node_env=production env-cmd -f .env.production yarn run prebuild &amp;&amp; env-cmd -f .env.production next build", "start:production": "node_env=production env-cmd -f .env.production next start", "postbuild": "next-sitemap", "start": "next start", "lint": "next lint", "typecheck": "tsc --noemit", "test": "vitest run", "test:watch": "vitest", "test:coverage": "vitest run --coverage", "test:e2e": "playwright test", "test:e2e:ui": "playwright test --ui", "test:e2e:debug": "playwright test --debug", "scan": "npx react-scan@latest localhost:3000" }, "dependencies": { "@headlessui/react": "^1.7.10", "@heroicons/react": "^1.0.6", "@sentry/nextjs": "^7.105.0", "@tailwindcss/aspect-ratio": "^0.4.2", "@tailwindcss/forms": "^0.5.3", "@tailwindcss/postcss": "^4.1.14", "@tailwindcss/typography": "^0.5.9", "autoprefixer": "^10.4.20", "axios": "^1.4.0", "cloudinary": "^2.7.0", "critters": "^0.0.25", "cssnano": "^7.0.6", "date-fns": "^2.29.3", "fast-xml-parser": "^4.4.0", "feed": "^4.2.2", "isomorphic-dompurify": "^2.25.0", "next": "^15.3.5", "postcss": "^8.5.1", "react": "^19.1.0", "react-datepicker": "^4.9.0", "react-dom": "^19.1.0", "react-select": "^5.7.0", "react-share": "^5.0.3", "react-tooltip": "^5.26.0", "swr": "^2.2.5", "tailwindcss": "^3.3.6", "zod": "3.24.3", "zustand": "^4.5.2" }, "devdependencies": { "@next/bundle-analyzer": "^13.1.6", "@playwright/test": "^1.48.0", "@testing-library/jest-dom": "^5.16.5", "@testing-library/react": "^14.0.0", "@testing-library/react-hooks": "^8.0.1", "@types/jest": "^30.0.0", "@types/jsdom": "^21.1.7", "@types/node": "^22.9.1", "@types/react": "^19.0.7", "@types/react-datepicker": "^7.0.0", "@types/react-dom": "^18.3.1", "@typescript-eslint/eslint-plugin": "^8.30.1", "@typescript-eslint/parser": "^8.30.1", "@vitejs/plugin-react": "^4.3.0", "babel-plugin-react-compiler": "^19.1.0-rc.1", "cross-env": "^7.0.3", "env-cmd": "^10.1.0", "eslint": "^8.57.0", "eslint-config-next": "^14.2.3", "eslint-plugin-react-hooks": "^6.0.0-rc.1", "jsdom": "^24.0.0", "next-sitemap": "^4.2.3", "prettier-eslint": "^15.0.1", "ts-node": "^10.9.2", "ttf2woff2": "^8.0.0", "typescript": "^5.6.3", "vite": "^5.4.0", "vite-tsconfig-paths": "^4.3.0", "vitest": "^1.6.0", "wait-on": "^8.0.4" }, "packagemanager": "yarn@4.9.1", "browserslist": [ "&gt; 1%", "last 2 versions", dead", ie 11" ] }</file><file name="playwright.config.ts">import { defineconfig, devices } "@playwright/test"; export default defineconfig({ testdir: "./e2e", fullyparallel: true, forbidonly: !!process.env.ci, retries: process.env.ci ? 2 : 0, workers: process.env.ci ? 1 : undefined, reporter: process.env.ci ? "blob" : [["list"], ["html", { open: "never" }]], use: { baseurl: process.env.playwright_test_base_url || "http://localhost:3000", navigationtimeout: 45000, trace: "on-first-retry", screenshot: "only-on-failure", video: "retain-on-failure", }, projects: [ { name: "chromium", use: { ...devices["desktop chrome"] }, }, ], webserver: { command: "yarn dev", url: process.env.playwright_test_base_url || "http://localhost:3000", reuseexistingserver: true, timeout: 120000, }, expect: { timeout: 10000 }, // provide env app server (next.js) via process.env ci start step. // github actions set next_public_api_url; also export e2e_test_mode enable deterministic publish flow. });</file><file name="playwright.remote.config.ts">import { defineconfig, devices } "@playwright/test"; // remote config run existing deployed url (e.g., amplify preview) // important: start local webserver const baseurl = process.env.playwright_test_base_url || "http://localhost:3000"; export default defineconfig({ testdir: "./e2e", fullyparallel: true, forbidonly: !!process.env.ci, retries: process.env.ci ? 2 : 0, workers: process.env.ci ? 1 : undefined, reporter: process.env.ci ? "blob" : [["list"], ["html", { open: "never" }]], use: { baseurl, navigationtimeout: 45000, trace: "on-first-retry", screenshot: "only-on-failure", video: "retain-on-failure", }, projects: [ { name: "chromium", use: { ...devices["desktop chrome"] }, }, ], expect: { timeout: 10000 }, });</file><file name="postcss.config.js">module.exports = { plugins: { tailwindcss: {}, autoprefixer: {}, cssnano: { preset: "default" }, }, };</file><file name="project-snapshot.txt">&lt;?xml version='1.0' encoding='utf-8'?&gt; &lt;source type="github_repository"&gt;&lt;commit&gt;unknown&lt;/commit&gt;&lt;file name=".eslintrc.json"&gt;{ "plugins": ["@typescript-eslint"], "extends": [ "eslint:recommended", "next", "next/core-web-vitals", "plugin:@typescript-eslint/recommended" ], "rules": { "no-unused-vars": "warn", "no-undef": "error", "no-debugger": "error", "react/react-in-jsx-scope": }, "env": { "es6": true, "browser": true, "node": true, "jest": true }, "overrides": [ { "files": ["public/sw.js", "public/sw-template.js"], "env": { "serviceworker": true }, "globals": { "workbox": "readonly", "importscripts": "readonly", "caches": "readonly", "self": "readonly" }, "rules": { "no-undef": } }, { "files": ["*.ts", "*.tsx"], "rules": { "no-undef": } }, { "files": [ "components/**/*.{ts,tsx,js,jsx}", "app/**/*.{ts,tsx,js,jsx}", "store.ts", "utils/**/*.{ts,tsx,js,jsx}" ], "rules": { "no-restricted-syntax": [ "error", { "selector": "tstypealiasdeclaration", "message": declare types outside /types directory. centralize type aliases /types." }, { "selector": "tsinterfacedeclaration", "message": declare interfaces outside /types directory. centralize interfaces /types." } ] } } ] }&lt;/file&gt;&lt;file name=".yarnrc.yml"&gt;nodelinker: node-modules yarnpath: .yarn/releases/yarn-4.9.1.cjs&lt;/file&gt;&lt;file name="readme.md"&gt;[next.js](https://nextjs.org/) project bootstrapped [`create-next-app`](https://github.com/vercel/next.js/tree/canary/packages/create-next-app). ## getting started first, run development server: ```bash npm run dev # yarn dev ``` open [http://localhost:3000](http://localhost:3000) browser see result. start editing page modifying `pages/index.js`. page auto-updates edit file. [api routes](https://nextjs.org/docs/api-routes/introduction) accessed [http://localhost:3000/api/hello](http://localhost:3000/api/hello). endpoint edited `pages/api/hello.js`. `pages/api` directory mapped `/api/*`. files directory treated [api routes](https://nextjs.org/docs/api-routes/introduction) instead react pages. ## learn learn next.js, take look following resources: - [next.js documentation](https://nextjs.org/docs) - learn next.js features api. - [learn next.js](https://nextjs.org/learn) - interactive next.js tutorial. check next.js github repository](https://github.com/vercel/next.js/) - feedback contributions welcome! ## deploy vercel easiest way deploy next.js app use [vercel platform](https://vercel.com/new?utm_medium=default-template&amp;amp;filter=next.js&amp;amp;utm_source=create-next-app&amp;amp;utm_campaign=create-next-app-readme) creators next.js. check [next.js deployment documentation](https://nextjs.org/docs/deployment) details.&lt;/file&gt;&lt;file name="amplify.yml"&gt;version: 1 frontend: phases: prebuild: commands: # use yarn --frozen-lockfile fast, deterministic builds ci. - yarn install --frozen-lockfile # remove existing keys, write single, up-to-date copy - sed '/^next_public_build_id=/d' .env.production 2&amp;gt;/dev/null || true - sed '/^next_telemetry_disabled=/d' .env.production 2&amp;gt;/dev/null || true - | { echo "next_public_build_id=${aws_commit_id:-$(date echo "next_telemetry_disabled=1" } &amp;gt;&amp;gt; .env.production build: commands: - echo "building next.js application..." - test -f scripts/generate-sw.mjs || { echo "generate-sw.mjs missing"; exit 1; } - node scripts/generate-sw.mjs - yarn build artifacts: basedirectory: .next files: - "**/*" cache: paths: - node_modules/**/* - .next/cache/**/* - .yarn/cache/**/* # static asset caching configured optimal performance. # security headers dynamic content managed middleware.ts. # assets using getversionedurl() longer cache times. customheaders: # next.js built assets - automatically hashed, safe long cache - pattern: "/_next/static/**" headers: - key: cache-control value: "public, max-age=31536000, immutable" # next.js optimized images - 1 year cache (critical performance) - pattern: "/_next/image*" headers: - key: cache-control value: "public, max-age=31536000, immutable" # css files - safe long cache since /styles/non-critical.css uses getversionedurl - pattern: "/styles/**" headers: - key: cache-control value: "public, max-age=31536000, immutable" - key: content-type value: "text/css; charset=utf-8" # font files - longer cache cors headers cross-origin loading - pattern: "/static/fonts/**" headers: - key: cache-control value: "public, max-age=31536000, immutable" - key: access-control-allow-origin value: "*" - key: cross-origin-resource-policy value: "cross-origin" # static assets - conservative since may use getversionedurl - pattern: "/static/**" headers: - key: cache-control value: "public, max-age=2592000" # 30 days # static images user uploads) - conservative approach # separate patterns common image extensions (brace expansion supported) - pattern: "/static/**/*.png" headers: - key: cache-control value: "public, max-age=2592000" # 30 days - pattern: "/static/**/*.jpg" headers: - key: cache-control value: "public, max-age=2592000" # 30 days - pattern: "/static/**/*.jpeg" headers: - key: cache-control value: "public, max-age=2592000" # 30 days - pattern: "/static/**/*.gif" headers: - key: cache-control value: "public, max-age=2592000" # 30 days - pattern: "/static/**/*.webp" headers: - key: cache-control value: "public, max-age=2592000" # 30 days - pattern: "/static/**/*.svg" headers: - key: cache-control value: "public, max-age=2592000" # 30 days - pattern: "/static/**/*.ico" headers: - key: cache-control value: "public, max-age=2592000" # 30 days # fonts - longer cache since rarely change - pattern: "**/*.{woff,woff2,ttf,eot}" headers: - key: cache-control value: "public, max-age=31536000" # 1 year # api routes - cors headers functionality (middleware excludes - pattern: "/api/**" headers: - key: access-control-allow-origin value: "https://esdeveniments.cat" - key: access-control-allow-methods value: "get,options,patch,delete,post,put" - key: access-control-allow-headers value: "x-csrf-token, x-requested-with, accept, accept-version, content-length, content-md5, content-type, date, x-api-version" - key: vary value: "origin" - key: cache-control value: "public, max-age=3600" # 1 hour - conservative api responses # environment variables set amplify console better security. # go app settings &amp;gt; environment variables # recommended variables: # node_env: production # next_telemetry_disabled: 1&lt;/file&gt;&lt;file name="jest.config.js"&gt;const nextjest = require("next/jest"); const createjestconfig = nextjest({ dir: "./", }); const customjestconfig = { testenvironment: "jsdom", setupfilesafterenv: ["&amp;lt;rootdir&amp;gt;/test/setup.ts"], testpathignorepatterns: ["&amp;lt;rootdir&amp;gt;/.next/", "&amp;lt;rootdir&amp;gt;/node_modules/"], modulenamemapper: { "^@/(.*)$": "&amp;lt;rootdir&amp;gt;/$1", "^@components/(.*)$": "&amp;lt;rootdir&amp;gt;/components/$1", "^@utils/(.*)$": "&amp;lt;rootdir&amp;gt;/utils/$1", "^@config/(.*)$": "&amp;lt;rootdir&amp;gt;/config/$1", }, transform: { "^.+\\.(js|jsx|ts|tsx)$": ["babel-jest", { presets: ["next/babel"] }], }, testmatch: ["**/*.test.(js|jsx|ts|tsx)"], collectcoveragefrom: [ "components/**/*.{js,jsx,ts,tsx}", "utils/**/*.{js,jsx,ts,tsx}", "config/**/*.{js,jsx,ts,tsx}", "!**/*.d.ts", "!**/node_modules/**", ], }; module.exports = createjestconfig(customjestconfig);&lt;/file&gt;&lt;file name="jest.config.ts"&gt;import nextjest 'next/jest'; import type { config } '@jest/types'; const createjestconfig = nextjest({ dir: './', }); const customjestconfig: config.initialoptions = { testenvironment: 'jsdom', setupfilesafterenv: ['&amp;lt;rootdir&amp;gt;/test/setup.ts'], testpathignorepatterns: ['&amp;lt;rootdir&amp;gt;/.next/', '&amp;lt;rootdir&amp;gt;/node_modules/'], modulenamemapper: { '^@/(.*)$': '&amp;lt;rootdir&amp;gt;/$1', '^@components/(.*)$': '&amp;lt;rootdir&amp;gt;/components/$1', '^@utils/(.*)$': '&amp;lt;rootdir&amp;gt;/utils/$1', '^@config/(.*)$': '&amp;lt;rootdir&amp;gt;/config/$1', }, transform: { '^.+\\.(js|jsx|ts|tsx)$': ['babel-jest', { presets: ['next/babel'] }], }, testmatch: ['**/*.test.(js|jsx|ts|tsx)'], globals: { 'ts-jest': { tsconfig: { jsx: 'react', }, }, }, }; export default createjestconfig(customjestconfig);&lt;/file&gt;&lt;file name="jest.setup.ts"&gt;// jest setup file typescript // learn https://github.com/testing-library/jest-dom import '@testing-library/jest-dom';&lt;/file&gt;&lt;file name="jsconfig.json"&gt;{ "compileroptions": { "baseurl": ".", "paths": { "@store": ["store.js"], "@app/*": ["app/*"], "@components/*": ["components/*"], "@styles/*": ["styles/*"], "@content/*": ["content/*"], "@utils/*": ["utils/*"], "@lib/*": ["lib/*"], "@config/*": ["config/*"], "@public/*": ["public/*"], "@types/*": ["types/*"] }, "types": ["./types/react-datepicker.d.ts", "./types/navigator.d.ts"] } }&lt;/file&gt;&lt;file name="middleware.ts"&gt;import { nextrequest, nextresponse } "next/server"; // determine environment development const isdev = process.env.node_env !== "production"; // get api origin multiple fallback strategies edge runtime // edge runtime limitations environment variables const getapiorigin = () =&amp;gt; { // strategy 1: try environment variable (works cases) const apiurl = process.env.next_public_api_url; (apiurl) { try { return new url(apiurl).origin; } catch { console.warn("invalid next_public_api_url format:", apiurl); } } // strategy 2: fallback based node_env const nodeenv = process.env.node_env; (nodeenv === "production") { return "https://api.esdeveniments.cat"; // production api } // strategy 3: default fallback (development/staging) return "https://api-pre.esdeveniments.cat"; }; /** * generates balanced maintainable content security policy. * @param nonce - unique string 'nonce-' directive. * @returns csp string. */ function getcsp(nonce: string) { const apiorigin = getapiorigin(); const cspdirectives = { // default, allow resources domain. "default-src": ["'self'"], // --- script security important part) --- // gold standard. ensures scripts nonce run. // 'strict-dynamic' allows trusted script load scripts, // essential services like google ads analytics. // avoids whitelist every single google domain scripts. "script-src": [ "'self'", `'nonce-${nonce}'`, "'strict-dynamic'", isdev ? "'unsafe-eval'" : "", // next.js fast refresh dev isdev ? "localhost:*" : "", // allow localhost scripts dev next.js chunks isdev ? "127.0.0.1:*" : "", // allow 127.0.0.1 scripts dev next.js chunks ], // --- style security --- "style-src": ["'self'", "'unsafe-inline'"], // --- resources flexible maintainability) --- // instead whitelisting every domain, allow connections secure (https) source. // prevents services breaking change endpoints. "connect-src": [ "'self'", apiorigin, // dynamic external api based environment "https:", // allows https connection isdev ? "wss:" : "", // next.js fast refresh dev isdev ? "ws:" : "", // next.js fast refresh dev (non-secure) isdev ? "localhost:*" : "", // allow localhost connections dev isdev ? "127.0.0.1:*" : "", // allow 127.0.0.1 connections dev ], "img-src": ["'self'", "data:", "https:"], // allows https image "font-src": ["'self'"], "frame-src": ["'self'", "https:"], // allows https iframe // --- lockdown directives (hardening) --- "worker-src": ["'self'", "blob:"], "object-src": ["'none'"], // disallow plugins like flash "base-uri": ["'self'"], "form-action": ["'self'"], "frame-ancestors": ["'self'"], // prevents clickjacking // 'report-uri': 'your_sentry_reporting_endpoint', }; return object.entries(cspdirectives) .map(([key, value]) =&amp;gt; `${key} ${value.filter(boolean).join(" ")}`) .join("; "); } export function middleware(request: nextrequest) { const { pathname } = request.nexturl; // --- handle service worker --- // apply specific caching headers service worker return early. (pathname === "/sw.js") { const response = nextresponse.next(); response.headers.set( "cache-control", "no-cache, no-store, must-revalidate" ); response.headers.set("service-worker-allowed", "/"); return response; } // --- handle redirects --- const segments = pathname.split("/").filter(boolean); ( (segments.length === 3 || segments.length === 2) &amp;amp;&amp;amp; segments[1] === "tots" ) { const newpath = segments.length === 3 ? `/${segments[0]}/${segments[2]}` : `/${segments[0]}`; const searchparams = request.nexturl.searchparams.tostring(); const finalurl = searchparams ? `${newpath}?${searchparams}` : newpath; return nextresponse.redirect(new url(finalurl, request.url), 301); } // --- generate apply security headers pages --- const nonce = crypto.randomuuid(); const csp = getcsp(nonce); const requestheaders = new headers(request.headers); requestheaders.set("x-nonce", nonce); requestheaders.set("x-pathname", pathname); const response = nextresponse.next({ request: { headers: requestheaders, }, }); response.headers.set("content-security-policy", csp); response.headers.set( "strict-transport-security", "max-age=63072000; includesubdomains; preload" ); response.headers.set("x-content-type-options", "nosniff"); response.headers.set("x-frame-options", "sameorigin"); response.headers.set("referrer-policy", "strict-origin-when-cross-origin"); response.headers.set( "permissions-policy", "camera=(), microphone=(), geolocation=(self)" ); return response; } export const config = { matcher: [ /* * match request paths except ones starting * - api (api routes) * - _next (next.js internal files) * - favicon.ico (favicon file) * - robots.txt, sitemap.xml, ads.txt (seo files) * - static (static assets) * - styles (css files) * - sw.js (service worker) */ "/((?!api|_next|favicon.ico|robots.txt|sitemap\\.xml|ads.txt|static|styles|sw\\.js).*)", ], };&lt;/file&gt;&lt;file name="next-sitemap.config.js"&gt;const siteurl = process.env.node_env !== "production" ? "http://localhost:3000" : process.env.next_public_vercel_env === "preview" || process.env.next_public_vercel_env === "development" ? "https://esdeveniments.vercel.app" : "https://www.esdeveniments.cat"; module.exports = { siteurl, exclude: [ "api", "_app.js", "_document.js", "404.js", "_error.js", "sitemap.xml.js", "server-sitemap.xml", "server-sitemap.xml.js", "/server-sitemap.xml", "/server-sitemap.xml.js", "rss.xml", "/rss.xml", ".next", "___next_launcher.js", "___vc", "node_modules", "package.json", "e/[eventid]", "[place]", ], generaterobotstxt: true, robotstxtoptions: { policies: [ { useragent: "*", disallow: ["/404"], }, { useragent: "*", allow: "/" }, ], additionalsitemaps: [ `${siteurl}/sitemap.xml`, `${siteurl}/server-sitemap.xml`, ], }, };&lt;/file&gt;&lt;file name="next-sitemap.d.ts"&gt;declare module 'next-sitemap' { export const getserversidesitemaplegacy: export type isitemapfield = }&lt;/file&gt;&lt;file name="next.config.js"&gt;const { withsentryconfig } = require("@sentry/nextjs"); /** @type {import('next').nextconfig} */ const nextconfig = { // --- core settings --- reactstrictmode: true, poweredbyheader: false, compress: true, productionbrowsersourcemaps: true, // --- experimental features --- experimental: { scrollrestoration: true, reactcompiler: true, // react compiler experimental }, // --- optimizations --- compiler: { removeconsole: process.env.node_env === "production", }, // --- image optimization --- images: { // important: whitelist specific domains load images // using wildcards security risk. remotepatterns: [ { protocol: "https", hostname: "**" }, { protocol: "http", hostname: "**" }, ], devicesizes: [480, 640, 768, 1024, 1280, 1600, 1920], imagesizes: [16, 32, 48, 64, 96, 128, 256, 384], formats: ["image/avif", "image/webp"], minimumcachettl: 86400, }, // `headers` block removed. // security caching headers managed dynamically `middleware.ts`. // recommended approach implementing strict csp nonces. // --- redirects --- async redirects() { return []; }, }; const sentrywebpackpluginoptions = { silent: true, org: "esdeveniments", project: "javascript-nextjs", widenclientfileupload: true, transpileclientsdk: true, hidesourcemaps: true, disablelogger: true, automaticvercelmonitors: true, }; module.exports = withsentryconfig(nextconfig, sentrywebpackpluginoptions);&lt;/file&gt;&lt;file name="package.json"&gt;{ "private": true, "scripts": { "analyze": "cross-env analyze=true next build", "analyze:server": "cross-env bundle_analyze=server next build", "analyze:browser": "cross-env bundle_analyze=browser next build", "vercel-build": "yarn run prebuild &amp;amp;&amp;amp; next build &amp;amp;&amp;amp; yarn run postbuild", "dev": "yarn run prebuild &amp;amp;&amp;amp; next dev", "build": "yarn run prebuild &amp;amp;&amp;amp; next build", "prebuild": "node scripts/generate-sw.mjs", "build:development": "node_env=development env-cmd -f .env.development yarn run prebuild &amp;amp;&amp;amp; env-cmd -f .env.development next build", "start:development": "env-cmd -f .env.development next start", "build:staging": "node_env=staging env-cmd -f .env.staging yarn run prebuild &amp;amp;&amp;amp; env-cmd -f .env.staging next build", "start:staging": "env-cmd -f .env.staging next start", "build:production": "node_env=production env-cmd -f .env.production yarn run prebuild &amp;amp;&amp;amp; env-cmd -f .env.production next build", "start:production": "node_env=production env-cmd -f .env.production next start", "postbuild": "next-sitemap", "start": "next start", "lint": "next lint", "test": "jest", "test:watch": "jest --watch", "typecheck": "tsc --noemit", "scan": "npx react-scan@latest localhost:3000" }, "dependencies": { "@headlessui/react": "^1.7.10", "@heroicons/react": "^1.0.6", "@sentry/nextjs": "^7.105.0", "@tailwindcss/aspect-ratio": "^0.4.2", "@tailwindcss/forms": "^0.5.3", "@tailwindcss/typography": "^0.5.9", "autoprefixer": "^10.4.20", "axios": "^1.4.0", "critters": "^0.0.25", "cssnano": "^7.0.6", "date-fns": "^2.29.3", "fast-xml-parser": "^4.4.0", "feed": "^4.2.2", "isomorphic-dompurify": "^2.25.0", "next": "^15.3.5", "postcss": "^8.5.1", "react": "^19.1.0", "react-datepicker": "^4.9.0", "react-dom": "^19.1.0", "react-select": "^5.7.0", "react-share": "^5.0.3", "react-tooltip": "^5.26.0", "swr": "^2.2.5", "tailwindcss": "^3.3.6", "zod": "3.24.3", "zustand": "^4.5.2" }, "devdependencies": { "@next/bundle-analyzer": "^13.1.6", "@testing-library/jest-dom": "^5.16.5", "@testing-library/react": "^14.0.0", "@testing-library/react-hooks": "^8.0.1", "@types/jest": "^30.0.0", "@types/node": "^22.9.1", "@types/react": "^19.0.7", "@types/react-datepicker": "^7.0.0", "@types/react-dom": "^18.3.1", "@typescript-eslint/eslint-plugin": "^8.30.1", "@typescript-eslint/parser": "^8.30.1", "babel-plugin-react-compiler": "^19.1.0-rc.1", "cross-env": "^7.0.3", "env-cmd": "^10.1.0", "eslint": "^8.57.0", "eslint-config-next": "^14.2.3", "eslint-plugin-react-hooks": "^6.0.0-rc.1", "jest": "^29.7.0", "jest-environment-jsdom": "^29.7.0", "next-sitemap": "^4.2.3", "prettier-eslint": "^15.0.1", "ts-node": "^10.9.2", "ttf2woff2": "^8.0.0", "typescript": "^5.6.3" }, "packagemanager": "yarn@4.9.1", "browserslist": [ "&amp;gt; 1%", "last 2 versions", dead", ie 11" ] }&lt;/file&gt;&lt;file name="postcss.config.js"&gt;module.exports = { plugins: { tailwindcss: {}, autoprefixer: {}, cssnano: { preset: "default" }, }, };&lt;/file&gt;&lt;file name="sentry.client.config.ts"&gt;// file configures initialization sentry client. // config add used whenever users loads page browser. // https://docs.sentry.io/platforms/javascript/guides/nextjs/ import { init } '@sentry/nextjs'; import type { browseroptions } '@sentry/nextjs'; const sentryclientconfig = { // add sentry client config }; (process.env.node_env === 'production') { const config: browseroptions = { dsn: process.env.next_public_sentry_dns, environment: process.env.next_public_vercel_env, tracessamplerate: 1.0, replaysonerrorsamplerate: 1.0, replayssessionsamplerate: 0.1, debug: false, }; init(config); } export default sentryclientconfig;&lt;/file&gt;&lt;file name="sentry.edge.config.ts"&gt;// file configures initialization sentry edge features (middleware, edge routes, etc). // config add used whenever one edge features loaded. // https://docs.sentry.io/platforms/javascript/guides/nextjs/ import { init } '@sentry/nextjs'; import type { edgeoptions } '@sentry/nextjs'; (process.env.node_env === 'production') { const config: edgeoptions = { dsn: process.env.next_public_sentry_dns, environment: process.env.next_public_vercel_env, tracessamplerate: 1.0, debug: false, }; init(config); }&lt;/file&gt;&lt;file name="sentry.server.config.ts"&gt;// file configures initialization sentry server. // config add used whenever page built server ssr used. // https://docs.sentry.io/platforms/javascript/guides/nextjs/ import { init } '@sentry/nextjs'; import type { nodeoptions } '@sentry/nextjs'; (process.env.node_env === 'production') { const config: nodeoptions = { dsn: process.env.sentry_dsn, environment: process.env.next_public_vercel_env, tracessamplerate: 1.0, debug: false, }; init(config); }&lt;/file&gt;&lt;file name="store.ts"&gt;import { create } "zustand"; import { persist, createjsonstorage } "zustand/middleware"; // base interfaces export interface userlocation { latitude: number; longitude: number; } export interface eventlocation { latitude: number; longitude: number; } export enum eventcategory { "festes majors" = "festa major", festivals = "festival", familiar = "familiar", msica = "msica", cinema = "cinema", teatre = "teatre", exposicions = "exposici", fires = "fira", espectacles = "espectacles", } // dynamic category interface new system export interface dynamiceventcategory { id: number; name: string; slug: string; } // union type transition period - supports legacy dynamic export type eventcategorytype = eventcategory | dynamiceventcategory | string; // note: following event interface frontend-only transformed events. // backend-aligned event data, use eventsummaryresponsedto listevent types/api/event. export interface event { id: string; title: string; description: string; image: string; /** url image uploaded user */ imageuploaded?: string; /** url image associated event */ imageurl: string; url: string; startdate: string; enddate: string; starttime: string; endtime: string; place: string; category: eventcategory | ""; distance?: number; location?: string; sublocation?: string; postalcode?: string; slug: string; isad?: boolean; formattedstart: string; formattedend?: string; isfulldayevent: boolean; duration: string; timeuntilevent: string; videourl?: string; nameday: string; weather?: { description?: string; icon?: string; }; } // filter state interface - removed: filters live url // url single source truth place, bydate, category, searchterm, distance // ui state interface interface uistate { openmodal: boolean; hydrated: boolean; } // combined store state interface - url-first, minimal state export interface storestate extends uistate { userlocation: userlocation | null; } // store actions interface - simplified export interface storeactions { setstate: &amp;lt;k extends keyof storestate&amp;gt;(key: k, value: storestate[k]) =&amp;gt; void; sethydrated: () =&amp;gt; void; } // complete store type export type store = storestate &amp;amp; storeactions; // create store minimal state const usestore = create&amp;lt;store&amp;gt;()( persist( (set) =&amp;gt; ({ // initial ui state openmodal: false, hydrated: false, // initial user location userlocation: null, // actions setstate: (key, value) =&amp;gt; { set((state) =&amp;gt; { // update specific property avoid unnecessary re-renders (state[key] === value) return state; // skip value changed return { ...state, [key]: value }; }); }, sethydrated: () =&amp;gt; { set((state) =&amp;gt; ({ ...state, hydrated: true })); }, }), { name: "events-ui", storage: createjsonstorage(() =&amp;gt; localstorage), partialize: (state) =&amp;gt; ({ // persist ui state survive browser restarts hydrated: state.hydrated, }), } ) ); export default usestore;&lt;/file&gt;&lt;file name="tailwind.config.js"&gt;/** @type {import('tailwindcss').config} */ module.exports = { content: ["./components/**/*.{js,ts,jsx,tsx}", "./app/**/*.{js,ts,jsx,tsx}"], theme: { extend: { fontfamily: { roboto: ["var(--font-roboto-flex)", "sans-serif"], barlow: ["var(--font-barlow-condensed)", "sans-serif"], }, screens: { xs: "360px", sm: "576px", md: "768px", lg: "1024px", xl: "1280px", }, animation: { "fast-pulse": "fast-pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite", "fast-pulse1": "fast-pulse 300ms cubic-bezier(0.4, 0, 0.6, 1) 100ms", appear: "appear 500ms", disappear: "disappear 500ms", }, keyframes: { "fast-pulse": { "0%, 100%": { opacity: 1 }, "50%": { opacity: 0 }, }, appear: { "0%": { opacity: 0 }, "100%": { opacity: 1 }, }, disappear: { "0%": { opacity: 1 }, "100%": { opacity: 0 }, }, }, boxshadow: { lg: "4px 4px 9px -3px #45454590", }, flex: { 2: "2 2 0%", 3: "3 3 0%", 4: "4 4 0%", }, zindex: { 1: "1", 900: "900", }, }, colors: { primary: "#ff0037", primarydark: "#c8033f", primarysoft: "#ff003750", whitecorp: "#ffffff", darkcorp: "#f7f7f7", blackcorp: "#454545", bcolor: "#cccccc", }, }, variants: { extend: { opacity: ["disabled"], cursor: ["disabled"], }, }, plugins: [ require("@tailwindcss/aspect-ratio"), require("@tailwindcss/typography"), require("@tailwindcss/forms"), ], };&lt;/file&gt;&lt;file name="tsconfig.json"&gt;{ "compileroptions": { "target": "es2021", "lib": [ "dom", "dom.iterable", "esnext" ], "allowjs": false, "skiplibcheck": true, "strict": true, "noemit": true, "esmoduleinterop": true, "module": "esnext", "moduleresolution": "bundler", "resolvejsonmodule": true, "isolatedmodules": true, "jsx": "preserve", "incremental": true, "downleveliteration": true, "plugins": [ { "name": "next" } ], "baseurl": ".", "paths": { "@store": [ "store.ts" ], "@app/*": [ "app/*" ], "@components/*": [ "components/*" ], "@styles/*": [ "styles/*" ], "@content/*": [ "content/*" ], "@utils/*": [ "utils/*" ], "@lib/*": [ "lib/*" ], "@config/*": [ "config/*" ], "@public/*": [ "public/*" ], "@types/*": [ "types/*" ], "react": [ "./node_modules/@types/react" ] }, "noimplicitreturns": true, "nofallthroughcasesinswitch": true, "nounusedlocals": true, "nounusedparameters": true, "types": [ "./types/react-datepicker.d.ts" ] }, "include": [ "**/*.ts", "**/*.tsx", "next-env.d.ts", "next.config.js", "postcss.config.js", "tailwind.config.js", ".next/types/**/*.ts" ], "exclude": [ "node_modules", ".next" ] }&lt;/file&gt;&lt;file name=".cursor/rules/readme.md"&gt;# apm framework - optional cursor ide rules directory, `rules/` (intended mirrored `.cursor/rules/` user's project choose use feature), contains optional [cursor ide rules](https://docs.cursor.com/context/rules). rules designed enhance robustness efficiency agentic project management (apm) framework used within cursor ide. use entirely optional primarily benefits users operating apm within cursor.** core apm prompts designed function effectively without rules. ## rules work cursor rules allow provide persistent, scoped instructions ai. context, manager agent prompted conditional "self-notes" specific points core protocols (e.g., `01_initiation_prompt.md` `02_codebase_guidance.md`). self-notes suggest user cursor rules enabled deems helpful, *may consider requesting* relevant rule name (e.g., `@rule_name`). approach ensures: 1. **optionality:** apm framework break rules used used outside cursor. 2. **targeted assistance:** rules invoked potentially beneficial specific, fragile parts workflow. 3. **contextual relevance:** ai (manager agent) uses rule's description current operational context decide activating rule appropriate. ## available rules (supporting manager agent) ### general initiation &amp;amp; planning phase * **`apm_discovery_synthesis_reminder.mdc`** * **description rule):** gathered extensive info (e.g., via `codebase_search`, `read_file`), rule prompts synthesize findings, identify next steps planning, explicitly consult user deep-diving `implementation_plan.md` generation. helps prevent premature planning based incomplete synthesis." * **purpose:** aids manager agent transitioning information gathering (discovery) structured planning, ensuring user alignment committing detailed plan. * **`apm_plan_format_source.mdc`** * **description rule):** "reminds `01_implementation_plan_guide.md` authoritative source formatting `implementation_plan.md`." * **purpose:** ensures uses correct guide tasked generating modifying implementation plan, promoting consistency. * **`apm_memory_system_format_source.mdc`** * **description rule):** "reminds `02_memory_bank_guide.md` authoritative source memory bank system setup (single vs multi-file) initial file headers." * **purpose:** ensures uses correct guide proposing setting project's memory bank, aligning project complexity. ### implementation plan integrity * **`apm_impl_plan_critical_elements_reminder.mdc`** (new) * **description rule):** "reminder implementation plan: ensure 1) explicit agent assignment (consider distribution) 2) 'guiding notes' critical action steps defined tasks." * **purpose:** reinforces necessity assigning agents every task including crucial "guiding notes" methodological consistency directly within `implementation_plan.md`. helps prevent ambiguity ensures tasks well-defined subsequent agent assignment. ### memory system integrity * **`apm_memory_naming_validation_reminder.mdc`** (new) * **description rule):** "reminder: validate memory bank file/directory names implementation plan creation. adhere conventions 02_memory_bank_guide.md." * **purpose:** promotes strict adherence memory bank naming conventions validation `implementation_plan.md` file directory created. crucial preventing structural errors memory bank. ### task assignment consistency * **`apm_task_prompt_plan_guidance_incorporation_reminder.mdc`** (new) * **description rule):** "reminder task assignment prompts: explicitly incorporate expand upon 'guiding notes' found implementation plan's action steps." * **purpose:** ensures manager agent generates detailed `task assignment prompts`, correctly uses elaborates "guiding notes" provided `implementation_plan.md`. maintains consistent line instruction high-level plan detailed task execution. ## using rules cursor 1. clone apm framework, `rules/` directory included. 2. make rules active cursor project, copy contents `rules/` directory `.cursor/rules/` directory root project. 3. ensure "project rules" enabled cursor settings.&lt;/file&gt;&lt;file name=".github/codeowners"&gt;* @albertolive&lt;/file&gt;&lt;file name=".github/issue_template.md"&gt;&amp;lt;!--- provide general summary issue title --&amp;gt; &amp;lt;!--- posting question, get rid rest template --&amp;gt; ## expected behavior &amp;lt;!--- describing bug, tell us happen --&amp;gt; &amp;lt;!--- suggesting change/improvement, tell us work --&amp;gt; ## current behavior &amp;lt;!--- describing bug, tell us happens instead expected behavior --&amp;gt; &amp;lt;!--- suggesting change/improvement, explain difference current behavior --&amp;gt; ## possible solution &amp;lt;!--- obligatory, suggest fix/reason bug, --&amp;gt; &amp;lt;!--- ideas implement addition change --&amp;gt; ## steps reproduce bugs) &amp;lt;!--- provide link live example, unambiguous set steps --&amp;gt; &amp;lt;!--- reproduce bug. include code reproduce, relevant --&amp;gt; 1. 2. 3. 4. ## context &amp;lt;!--- issue affected trying accomplish? --&amp;gt; &amp;lt;!--- providing context helps us come solution useful real world --&amp;gt; ## environment &amp;lt;!--- include many relevant details environment experienced bug --&amp;gt; - version used: - environment name version (e.g. node 18 macos): - server type version: - operating system version: - link project:&lt;/file&gt;&lt;file name=".github/pull_request_template.md" /&gt;&lt;file name="app/googlescripts.tsx"&gt;"use client"; import script "next/script"; import { googlescriptsprops } "types/props"; export default function googlescripts({ nonce }: googlescriptsprops) { return ( &amp;lt;&amp;gt; {/* google analytics */} &amp;lt;script id="google-analytics-gtag" strategy="afterinteractive" src={`https://www.googletagmanager.com/gtag/js?id=${process.env.next_public_google_analytics}`} nonce={nonce} /&amp;gt; &amp;lt;script id="google-analytics-lazy-load" strategy="afterinteractive" nonce={nonce} &amp;gt; {` window.datalayer = window.datalayer || []; function gtag(){datalayer.push(arguments);} gtag('js', new date()); gtag('config', '${process.env.next_public_google_analytics}', { page_path: window.location.pathname, }); `} &amp;lt;/script&amp;gt; {/* google ads */} &amp;lt;script id="google-ads" strategy="afterinteractive" crossorigin="anonymous" src={`https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=${process.env.next_public_google_ads}`} nonce={nonce} /&amp;gt; &amp;lt;script id="google-adblock" strategy="afterinteractive" nonce={nonce}&amp;gt; {` (function() { function signalgooglefcpresent() { (!window.frames['googlefcpresent']) { (document.body) { const iframe = document.createelement('iframe'); iframe.style = 'width: 0; height: 0; border: none; z-index: -1000; left: -1000px; top: -1000px;'; iframe.style.display = 'none'; iframe.name = 'googlefcpresent'; document.body.appendchild(iframe); } else { settimeout(signalgooglefcpresent, 0); } } } signalgooglefcpresent(); })(); `} &amp;lt;/script&amp;gt; &amp;lt;script src="https://fundingchoicesmessages.google.com/i/pub-2456713018173238?ers=1" strategy="afterinteractive" nonce={nonce} /&amp;gt; &amp;lt;/&amp;gt; ); }&lt;/file&gt;&lt;file name="app/error.tsx"&gt;"use client"; import { useeffect } "react"; import * sentry "@sentry/nextjs"; export default function error({ error, reset }: { error: error; reset: () =&amp;gt; void }) { useeffect(() =&amp;gt; { (error) { sentry.captureexception(error); } }, [error]); return ( &amp;lt;div style={{ padding: 32, textalign: "center" }}&amp;gt; &amp;lt;h1&amp;gt;alguna cosa ha anat malament&amp;lt;/h1&amp;gt; &amp;lt;p&amp;gt;{error?.message || "si us plau, torna-ho intentar."}&amp;lt;/p&amp;gt; &amp;lt;button onclick={reset} style={{ margintop: 16 }}&amp;gt; torna carregar &amp;lt;/button&amp;gt; &amp;lt;/div&amp;gt; ); }&lt;/file&gt;&lt;file name="app/global-error.tsx"&gt;"use client"; import * sentry "@sentry/nextjs"; export default function globalerror({ error, reset, }: { error: error; reset: () =&amp;gt; void; }) { sentry.captureexception(error); return ( &amp;lt;html&amp;gt; &amp;lt;body&amp;gt; &amp;lt;h2&amp;gt;alguna cosa ha anat malament (global)&amp;lt;/h2&amp;gt; &amp;lt;button onclick={() =&amp;gt; reset()}&amp;gt;torna carregar&amp;lt;/button&amp;gt; &amp;lt;/body&amp;gt; &amp;lt;/html&amp;gt; ); }&lt;/file&gt;&lt;file name="app/layout.tsx"&gt;import "../styles/critical.css"; import type { reactnode } "react"; import type { metadata, viewport } "next"; import { headers } "next/headers"; import googlescripts "./googlescripts"; import { baselayout } "@components/ui/layout"; import websiteschema "@components/partials/websiteschema"; import criticalcss "@components/partials/criticalcss"; import { robotoflex, barlowcondensed } "../lib/fonts"; export const metadata: metadata = { { "mobile-web-app-capable": "yes", "apple-mobile-web-app-status-bar-style": "default", }, alternates: { types: { "application/rss+xml": [{ url: "/rss.xml", title: "rss" }], }, }, }; export const viewport: viewport = { width: "device-width", initialscale: 1, themecolor: "#000000", }; export default async function rootlayout({ children, }: { children: reactnode; }) { // read nonce middleware headers const headerslist = await headers(); const nonce = headerslist.get("x-nonce") || ""; return ( &amp;lt;html lang="ca" classname={`${robotoflex.variable} ${barlowcondensed.variable}`} &amp;gt; &amp;lt;body&amp;gt; &amp;lt;link rel="preconnect" href="https://www.googletagmanager.com" /&amp;gt; &amp;lt;link rel="preconnect" href="https://www.google-analytics.com" /&amp;gt; &amp;lt;link rel="preconnect" href="https://pagead2.googlesyndication.com" /&amp;gt; &amp;lt;link rel="dns-prefetch" href="//cdnjs.cloudflare.com" /&amp;gt; &amp;lt;link rel="dns-prefetch" href="//www.google-analytics.com" /&amp;gt; &amp;lt;websiteschema nonce={nonce} /&amp;gt; &amp;lt;criticalcss /&amp;gt; &amp;lt;googlescripts nonce={nonce} /&amp;gt; &amp;lt;baselayout&amp;gt;{children}&amp;lt;/baselayout&amp;gt; &amp;lt;/body&amp;gt; &amp;lt;/html&amp;gt; ); }&lt;/file&gt;&lt;file name="app/manifest.ts"&gt;import type { metadataroute } "next"; export default function manifest(): metadataroute.manifest { return { name: "esdeveniments.cat", short_name: "esdeveniments", description: "descobreix els millors esdeveniments culturals de catalunya", start_url: "/", display: "standalone", background_color: "#ffffff", theme_color: "#000000", orientation: "portrait-primary", categories: ["entertainment", "lifestyle", "culture"], lang: "ca", dir: "ltr", icons: [ { src: "/static/icons/icon-192x192.png", sizes: "192x192", type: "image/png", purpose: }, { src: "/static/icons/icon-512x512.png", sizes: "512x512", type: "image/png", purpose: }, ], screenshots: [ { src: "/static/icons/icon-512x512.png", sizes: "512x512", type: "image/png", form_factor: "narrow", label: "mobile view esdeveniments.cat", }, { src: "/static/icons/icon-512x512.png", sizes: "512x512", type: "image/png", form_factor: "wide", label: "desktop view esdeveniments.cat", }, ], shortcuts: [ { name: "esdeveniments de barcelona", short_name: "barcelona", description: "veure esdeveniments de barcelona", url: "/barcelona", icons: [ { src: "/static/icons/today-icon.png", sizes: "96x96", type: "image/png", }, ], }, { name: "esdeveniments de girona", short_name: "girona", description: "veure esdeveniments de girona", url: "/girona", icons: [ { src: "/static/icons/today-icon.png", sizes: "96x96", type: "image/png", }, ], }, { name: "esdeveniments de catalunya", short_name: "catalunya", description: "veure tots els esdeveniments de catalunya", url: "/catalunya", icons: [ { src: "/static/icons/today-icon.png", sizes: "96x96", type: "image/png", }, ], }, { name: "publica un esdeveniment", short_name: "publica", description: "publica un nou esdeveniment", url: "/publica", icons: [ { src: "/static/icons/today-icon.png", sizes: "96x96", type: "image/png", }, ], }, ], }; }&lt;/file&gt;&lt;file name="app/not-found.tsx"&gt;"use client"; export default function notfound() { return ( &amp;lt;div style={{ padding: 32, textalign: "center" }}&amp;gt; &amp;lt;h1&amp;gt;pgina trobada&amp;lt;/h1&amp;gt; &amp;lt;p&amp;gt;no s&amp;amp;apos;ha pogut trobar la pgina que busques.&amp;lt;/p&amp;gt; href="/" style={{ color: "#0070f3", textdecoration: "underline" }}&amp;gt; torna l&amp;amp;apos;inici &amp;lt;/div&amp;gt; ); }&lt;/file&gt;&lt;file name="app/page.tsx"&gt;import { fetchcategorizedevents } "@lib/api/events"; import { fetchcategories } "@lib/api/categories"; import { generatepagesdata } "@components/partials/generatepagesdata"; import { buildpagemeta } "@components/partials/seo-meta"; import type { pagedata } "types/common"; import { categorizedevents } "types/api/event"; import type { categorysummaryresponsedto } "types/api/category"; import servereventscategorized "@components/ui/servereventscategorized"; import search "@components/ui/search"; import { suspense, jsx } "react"; export async function generatemetadata() { const pagedata: pagedata = await generatepagesdata({ currentyear: new date().getfullyear(), place: "", bydate: "", }); return buildpagemeta({ title: pagedata.metatitle, description: pagedata.metadescription, canonical: pagedata.canonical, }); } export default async function page(): promise&amp;lt;jsx.element&amp;gt; { // always fetch categorized events url filters support) const categorizedevents: categorizedevents = await fetchcategorizedevents(5); // fetch dynamic categories enhanced category support let categories: categorysummaryresponsedto[] = []; try { categories = await fetchcategories(); } catch (error) { // continue without categories - components use static fallbacks console.error("error fetching categories:", error); categories = []; } const pagedata: pagedata = await generatepagesdata({ currentyear: new date().getfullyear(), place: "", bydate: "", }); return ( &amp;lt;&amp;gt; &amp;lt;div classname="w-full flex justify-center items-center mx-auto px-2 lg:px-0 sm:w-[580px] md:w-[768px] lg:w-[1024px]"&amp;gt; &amp;lt;suspense fallback={ &amp;lt;div classname="w-full h-12 bg-whitecorp animate-pulse rounded-full" /&amp;gt; } &amp;gt; &amp;lt;search /&amp;gt; &amp;lt;/suspense&amp;gt; &amp;lt;/div&amp;gt; &amp;lt;servereventscategorized categorizedevents={categorizedevents} pagedata={pagedata} categories={categories} /&amp;gt; &amp;lt;/&amp;gt; ); }&lt;/file&gt;&lt;file name="app/[place]/page.tsx"&gt;import { redirect } "next/navigation"; import { headers } "next/headers"; import script "next/script"; import { fetchevents, insertads } "@lib/api/events"; import { fetchcategories } "@lib/api/categories"; import { getplacetypeandlabel } "@utils/helpers"; import { fetchregionswithcities, fetchregions } "@lib/api/regions"; import { generatepagesdata } "@components/partials/generatepagesdata"; import { buildpagemeta, generateitemliststructureddata, } "@components/partials/seo-meta"; import type { placestaticpathparams, placetypeandlabel, pagedata, } "types/common"; import type { categorysummaryresponsedto } "types/api/category"; import type { eventcategory } "@store"; import { fetcheventsparams } "types/event"; import hybrideventslist "@components/ui/hybrideventslist"; import clientinteractivelayer "@components/ui/clientinteractivelayer"; import { buildcanonicalurl } "@utils/url-filters"; import { validateplaceorthrow, validateplaceformetadata, } "@utils/route-validation"; import { iseventsummaryresponsedto } "types/api/iseventsummaryresponsedto"; import { fetchcities } "@lib/api/cities"; export const revalidate = 600; export async function generatestaticparams() { const [regions, cities] = await promise.all([fetchregions(), fetchcities()]); return [ ...regions.map((region) =&amp;gt; ({ place: region.slug })), ...cities.map((city) =&amp;gt; ({ place: city.slug })), ]; } export async function generatemetadata({ params, }: { params: promise&amp;lt;placestaticpathparams&amp;gt;; }) { const { place } = await params; const validation = validateplaceformetadata(place); (!validation.isvalid) { return validation.fallbackmetadata; } const placetypelabel: placetypeandlabel = await getplacetypeandlabel(place); const pagedata: pagedata = await generatepagesdata({ currentyear: new date().getfullyear(), place, bydate: "", placetypelabel, }); return buildpagemeta({ title: pagedata.metatitle, description: pagedata.metadescription, canonical: pagedata.canonical, }); } export default async function page({ params, searchparams, }: { params: promise&amp;lt;placestaticpathparams&amp;gt;; searchparams: promise&amp;lt;{ [key: string]: string | string[] | undefined }&amp;gt;; }) { const { place } = await params; const search = await searchparams; // read nonce middleware headers const headerslist = await headers(); const nonce = headerslist.get("x-nonce") || ""; validateplaceorthrow(place); const urlsearchparams = new urlsearchparams(); object.entries(search).foreach(([key, value]) =&amp;gt; { (typeof value === "string") { urlsearchparams.set(key, value); } else (array.isarray(value)) { urlsearchparams.set(key, value[0]); } }); const category = typeof search.category === "string" ? search.category : undefined; const date = typeof search.date === "string" ? search.date : undefined; const distance = typeof search.distance === "string" ? search.distance : undefined; const lat = typeof search.lat === "string" ? search.lat : undefined; const lon = typeof search.lon === "string" ? search.lon : undefined; const query = typeof search.search === "string" ? search.search : undefined; (category || date) { const canonicalurl = buildcanonicalurl({ place, bydate: date || "tots", category: (category eventcategory) || "tots", searchterm: query || "", distance: distance ? parseint(distance) : 50, lat: lat ? parsefloat(lat) : undefined, lon: lon ? parsefloat(lon) : undefined, }); redirect(canonicalurl); } const fetchparams: fetcheventsparams = { page: 0, size: 10, }; (place !== "catalunya") { fetchparams.place = place; } (category) fetchparams.category = category; // add distance/radius filter coordinates provided (lat &amp;amp;&amp;amp; lon) { (distance) { fetchparams.radius = parseint(distance); } fetchparams.lat = parsefloat(lat); fetchparams.lon = parsefloat(lon); } // add search query provided (query) { fetchparams.term = query; } let eventsresponse = await fetchevents(fetchparams); let noeventsfound = false; ( !eventsresponse || !eventsresponse.content || eventsresponse.content.length === 0 ) { const regionswithcities = await fetchregionswithcities(); const regionwithcities = regionswithcities.find((r) =&amp;gt; r.cities.some((city) =&amp;gt; city.value === place) ); (regionwithcities) { const regions = await fetchregions(); const regionwithslug = regions.find((r) =&amp;gt; r.id === regionwithcities.id); (regionwithslug) { eventsresponse = await fetchevents({ page: 0, size: 7, place: regionwithslug.slug, }); noeventsfound = true; } } } // final fallback: still events, fetch latest events filters (like catalunya homepage) ( !eventsresponse || !eventsresponse.content || eventsresponse.content.length === 0 ) { eventsresponse = await fetchevents({ page: 0, size: 7, // place, category, filters - get latest events }); noeventsfound = true; } const events = eventsresponse?.content || []; const eventswithads = insertads(events); let categories: categorysummaryresponsedto[] = []; try { categories = await fetchcategories(); } catch (error) { console.error("error fetching categories:", error); } const placetypelabel: placetypeandlabel = await getplacetypeandlabel(place); const pagedata = await generatepagesdata({ currentyear: new date().getfullyear(), place, bydate: "", placetypelabel, }); const validevents = events.filter(iseventsummaryresponsedto); const structureddata = validevents.length &amp;gt; 0 ? generateitemliststructureddata(validevents, `esdeveniments ${place}`) : null; return ( &amp;lt;&amp;gt; {/* json-ld structured data */} {structureddata &amp;amp;&amp;amp; ( &amp;lt;script id={`events-${place}`} type="application/ld+json" strategy="afterinteractive" nonce={nonce} dangerouslysetinnerhtml={{ __html: json.stringify(structureddata), }} /&amp;gt; )} {/* server-rendered events content (seo optimized) */} &amp;lt;hybrideventslist initialevents={eventswithads} placetypelabel={placetypelabel} pagedata={pagedata} noeventsfound={noeventsfound} place={place} category={category} date={date} serverhasmore={!eventsresponse?.last} /&amp;gt; {/* client-side interactive layer (search, filters, floating button) */} &amp;lt;clientinteractivelayer categories={categories} placetypelabel={placetypelabel} /&amp;gt; &amp;lt;/&amp;gt; ); }&lt;/file&gt;&lt;file name="app/[place]/[bydate]/page.tsx"&gt;import script "next/script"; import { fetchevents, insertads } "@lib/api/events"; import { fetchcategories } "@lib/api/categories"; import { getplacetypeandlabel, tolocaldatestring } "@utils/helpers"; import { generatepagesdata } "@components/partials/generatepagesdata"; import { buildpagemeta, generateitemliststructureddata, } "@components/partials/seo-meta"; import { today, tomorrow, week, weekend, twoweeksdefault } "@lib/dates"; import type { datefunctions } "types/dates"; import { placetypeandlabel, bydateoptions } "types/common"; import type { categorysummaryresponsedto } "types/api/category"; import { fetcheventsparams } "types/event"; import { fetchregionswithcities, fetchregions } "@lib/api/regions"; import hybrideventslist "@components/ui/hybrideventslist"; import clientinteractivelayer "@components/ui/clientinteractivelayer"; import { parsefiltersfromurl } "@utils/url-filters"; import { validateplaceorthrow, validateplaceformetadata, } "@utils/route-validation"; import { iseventsummaryresponsedto } "types/api/iseventsummaryresponsedto"; export async function generatemetadata({ params, }: { params: promise&amp;lt;{ place: string; bydate: string }&amp;gt;; }) { const { place, bydate } = await params; const validation = validateplaceformetadata(place); (!validation.isvalid) { return validation.fallbackmetadata; } let categories: categorysummaryresponsedto[] = []; try { categories = await fetchcategories(); } catch (error) { console.error("generatemetadata: error fetching categories:", error); } const parsed = parsefiltersfromurl( { place, date: bydate }, new urlsearchparams(), categories ); const actualdate = parsed.segments.date; const actualcategory = parsed.segments.category; const placetypelabel: placetypeandlabel = await getplacetypeandlabel(place); const categorydata = categories.find((cat) =&amp;gt; cat.slug === actualcategory); const pagedata = await generatepagesdata({ currentyear: new date().getfullyear(), place, bydate: actualdate bydateoptions, placetypelabel, category: actualcategory &amp;amp;&amp;amp; actualcategory !== "tots" ? actualcategory : undefined, categoryname: categorydata?.name, }); return buildpagemeta({ title: pagedata.metatitle, description: pagedata.metadescription, canonical: pagedata.canonical, }); } export async function generatestaticparams() { const topplaces = ["catalunya", "barcelona", "girona", "lleida", "tarragona"]; const topdates = [ "avui", "dema", "setmana", "cap-de-setmana", ] bydateoptions[]; let categories: categorysummaryresponsedto[] = []; try { categories = await fetchcategories(); } catch (error) { console.error("generatestaticparams: error fetching categories:", error); } const topcategories = categories.slice(0, 4).map((cat) =&amp;gt; cat.slug); const combinations = []; (const place topplaces) { (const date topdates) { combinations.push({ place, bydate: date }); } (const category topcategories) { combinations.push({ place, bydate: category }); } } return combinations; } export default async function bydatepage({ params, searchparams, }: { params: promise&amp;lt;{ place: string; bydate: string }&amp;gt;; searchparams: promise&amp;lt;{ [key: string]: string | string[] | undefined }&amp;gt;; }) { const { place, bydate } = await params; const search = await searchparams; validateplaceorthrow(place); let categories: categorysummaryresponsedto[] = []; try { categories = await fetchcategories(); } catch (error) { console.error( " [place]/[bydate]/page.tsx - error fetching categories:", error ); categories = []; } const parsed = parsefiltersfromurl( { place, date: bydate }, new urlsearchparams(), categories ); const actualdate = parsed.segments.date; const actualcategory = parsed.segments.category; const searchcategory = typeof search.category === "string" ? search.category : undefined; const finalcategory = searchcategory || actualcategory; const datefunctions: datefunctions = { avui: today, dema: tomorrow, setmana: week, "cap-de-setmana": weekend, }; const paramsforfetch: fetcheventsparams = { page: 0, size: 10, }; // add date filters actualdate "tots" (actualdate !== "tots") { const selectedfunction = datefunctions[actualdate keyof typeof datefunctions] || today; const { } = selectedfunction(); paramsforfetch.from = tolocaldatestring(from); paramsforfetch.to = tolocaldatestring(until); } (place !== "catalunya") { paramsforfetch.place = place; } (finalcategory &amp;amp;&amp;amp; finalcategory !== "tots") { paramsforfetch.category = finalcategory; } // add distance/radius filter provided const distance = typeof search.distance === "string" ? search.distance : undefined; const lat = typeof search.lat === "string" ? search.lat : undefined; const lon = typeof search.lon === "string" ? search.lon : undefined; const query = typeof search.search === "string" ? search.search : undefined; // add distance/radius filter coordinates provided (lat &amp;amp;&amp;amp; lon) { (distance) { paramsforfetch.radius = parseint(distance); } paramsforfetch.lat = parsefloat(lat); paramsforfetch.lon = parsefloat(lon); } // add search query provided (query) { paramsforfetch.term = query; } let noeventsfound = false; let eventsresponse = await fetchevents(paramsforfetch); let events = eventsresponse?.content || []; (!events || events.length === 0) { const regionswithcities = await fetchregionswithcities(); const regionwithcities = regionswithcities.find((r) =&amp;gt; r.cities.some((city) =&amp;gt; city.value === place) ); (regionwithcities) { const regions = await fetchregions(); const regionwithslug = regions.find((r) =&amp;gt; r.id === regionwithcities.id); (regionwithslug) { const { } = twoweeksdefault(); const fallbackparams: fetcheventsparams = { page: 0, size: 7, place: regionwithslug.slug, tolocaldatestring(from), tolocaldatestring(until), }; (finalcategory &amp;amp;&amp;amp; finalcategory !== "tots") { fallbackparams.category = finalcategory; } eventsresponse = await fetchevents(fallbackparams); events = eventsresponse?.content || []; noeventsfound = true; } } } // final fallback: still events, fetch latest events filters (like catalunya homepage) (!events || events.length === 0) { const { } = twoweeksdefault(); const latesteventsparams: fetcheventsparams = { page: 0, size: 7, tolocaldatestring(from), tolocaldatestring(until), // place, category, filters - get latest events }; eventsresponse = await fetchevents(latesteventsparams); events = eventsresponse?.content || []; noeventsfound = true; } const eventswithads = insertads(events); const placetypelabel: placetypeandlabel = await getplacetypeandlabel(place); const categorydata = categories.find((cat) =&amp;gt; cat.slug === finalcategory); const pagedata = await generatepagesdata({ currentyear: new date().getfullyear(), place, bydate: actualdate bydateoptions, placetypelabel, category: finalcategory &amp;amp;&amp;amp; finalcategory !== "tots" ? finalcategory : undefined, categoryname: categorydata?.name, }); const serverhasmore = eventsresponse ? !eventsresponse.last &amp;amp;&amp;amp; eventswithads.length &amp;lt; eventsresponse.totalelements : false; const validevents = eventswithads.filter(iseventsummaryresponsedto); const structureddata = validevents.length &amp;gt; 0 ? generateitemliststructureddata( validevents, finalcategory &amp;amp;&amp;amp; finalcategory !== "tots" ? `esdeveniments ${finalcategory} ${place}` : `esdeveniments ${actualdate} ${place}` ) : null; return ( &amp;lt;&amp;gt; {/* json-ld structured data */} {structureddata &amp;amp;&amp;amp; ( &amp;lt;script id={`events-${place}-${actualdate}`} type="application/ld+json" strategy="afterinteractive" dangerouslysetinnerhtml={{ __html: json.stringify(structureddata), }} /&amp;gt; )} {/* server-rendered events content (seo optimized) */} &amp;lt;hybrideventslist initialevents={eventswithads} placetypelabel={placetypelabel} pagedata={pagedata} noeventsfound={noeventsfound} place={place} category={finalcategory} date={actualdate} serverhasmore={serverhasmore} /&amp;gt; {/* client-side interactive layer (search, filters, floating button) */} &amp;lt;clientinteractivelayer categories={categories} placetypelabel={placetypelabel} /&amp;gt; &amp;lt;/&amp;gt; ); }&lt;/file&gt;&lt;file name="app/[place]/[bydate]/[category]/page.tsx"&gt;import { redirect } "next/navigation"; import script "next/script"; import { fetchevents, insertads } "@lib/api/events"; import { fetchcategories } "@lib/api/categories"; import { getplacetypeandlabel } "@utils/helpers"; import { generatepagesdata } "@components/partials/generatepagesdata"; import { buildpagemeta, generateitemliststructureddata, } "@components/partials/seo-meta"; import type { placetypeandlabel, pagedata, bydateoptions } "types/common"; import type { categorysummaryresponsedto } "types/api/category"; import { fetcheventsparams } "types/event"; import { filteredpageprops } "types/props"; import hybrideventslist "@components/ui/hybrideventslist"; import clientinteractivelayer "@components/ui/clientinteractivelayer"; import { parsefiltersfromurl, getredirecturl, urltofilterstate, gettopstaticcombinations, } "@utils/url-filters"; import { validateplaceorthrow, validateplaceformetadata, } "@utils/route-validation"; import { iseventsummaryresponsedto } "types/api/iseventsummaryresponsedto"; import { fetchregionswithcities, fetchregions } "@lib/api/regions"; import { tolocaldatestring } "@utils/helpers"; import { twoweeksdefault } "@lib/dates"; export const revalidate = 600; export async function generatemetadata({ params, }: { params: promise&amp;lt;{ place: string; bydate: string; category: string }&amp;gt;; }) { const { place, bydate, category } = await params; // security: validate place parameter const validation = validateplaceformetadata(place); (!validation.isvalid) { return validation.fallbackmetadata; } // fetch categories metadata generation first let categories: categorysummaryresponsedto[] = []; try { categories = await fetchcategories(); } catch (error) { console.error("error fetching categories metadata:", error); categories = []; } // parse filters metadata generation categories const parsed = parsefiltersfromurl( { place, date: bydate, category }, new urlsearchparams(), categories // passing categories like main function ); const filters = urltofilterstate(parsed); // find category name seo const categorydata = categories.find((cat) =&amp;gt; cat.slug === filters.category); const placetypeandlabel: placetypeandlabel = await getplacetypeandlabel( filters.place ); const pagedata: pagedata = await generatepagesdata({ currentyear: new date().getfullyear(), place: filters.place, bydate: filters.bydate bydateoptions, placetypelabel: placetypeandlabel, category: filters.category !== "tots" ? filters.category : undefined, categoryname: categorydata?.name, }); return buildpagemeta({ title: pagedata.title, description: pagedata.metadescription, canonical: pagedata.canonical, }); } export async function generatestaticparams() { // generate static params top combinations // combinations generated on-demand isr const combinations = gettopstaticcombinations(); // transform returned format { place, date, category } { place, bydate, category } return combinations.map(({ place, date, category }) =&amp;gt; ({ place, bydate: date, category, })); } export default async function filteredpage({ params, searchparams, }: filteredpageprops) { const { place, bydate, category } = await params; const search = await searchparams; // security: validate place parameter validateplaceorthrow(place); // convert searchparams urlsearchparams const urlsearchparams = new urlsearchparams(); object.entries(search).foreach(([key, value]) =&amp;gt; { (typeof value === "string") { urlsearchparams.set(key, value); } else (array.isarray(value)) { urlsearchparams.set(key, value[0]); } }); // fetch dynamic categories parsing url validate category slugs let categories: categorysummaryresponsedto[] = []; try { categories = await fetchcategories(); } catch (error) { // continue without categories - use static fallbacks console.error("error fetching categories:", error); categories = []; // fallback empty array fetch fails } // parse filters url dynamic categories validation const parsed = parsefiltersfromurl( { place, date: bydate, category }, urlsearchparams, categories ); // check redirect needed non-canonical urls const redirecturl = getredirecturl(parsed); (redirecturl) { redirect(redirecturl); } // convert filterstate compatibility const filters = urltofilterstate(parsed); // get place type label const placetypeandlabel: placetypeandlabel = await getplacetypeandlabel( filters.place ); // prepare fetch params const fetchparams: fetcheventsparams = { place: filters.place, bydate: filters.bydate bydateoptions, istoday: filters.bydate === "tots", category: filters.category !== "tots" ? filters.category : undefined, term: filters.searchterm || undefined, }; // add distance/radius filter coordinates provided (filters.lat &amp;amp;&amp;amp; filters.lon) { (filters.distance !== undefined) { fetchparams.radius = filters.distance; } fetchparams.lat = filters.lat; fetchparams.lon = filters.lon; } // fetch events let eventsresponse = await fetchevents(fetchparams); let events = eventsresponse?.content || []; let noeventsfound = false; // check need fetch fallback events region (!events || events.length === 0) { const regionswithcities = await fetchregionswithcities(); const regionwithcities = regionswithcities.find((r) =&amp;gt; r.cities.some((city) =&amp;gt; city.value === filters.place) ); (regionwithcities) { const regions = await fetchregions(); const regionwithslug = regions.find((r) =&amp;gt; r.id === regionwithcities.id); (regionwithslug) { // fetch events parent region without specific category filter const fallbackparams: fetcheventsparams = { page: 0, size: 7, place: regionwithslug.slug, bydate: filters.bydate bydateoptions, istoday: filters.bydate === "tots", }; eventsresponse = await fetchevents(fallbackparams); events = eventsresponse?.content || []; noeventsfound = true; } } } // final fallback: still events, fetch latest events filters (like catalunya homepage) (!events || events.length === 0) { const { } = twoweeksdefault(); const latesteventsparams: fetcheventsparams = { page: 0, size: 7, tolocaldatestring(from), tolocaldatestring(until), // place, category, filters - get latest events }; eventsresponse = await fetchevents(latesteventsparams); events = eventsresponse?.content || []; noeventsfound = true; } const eventswithads = insertads(events); // find category name seo const categorydata = categories.find((cat) =&amp;gt; cat.slug === filters.category); // generate page data seo const pagedata: pagedata = await generatepagesdata({ currentyear: new date().getfullyear(), place: filters.place, bydate: filters.bydate bydateoptions, placetypelabel: placetypeandlabel, category: filters.category !== "tots" ? filters.category : undefined, categoryname: categorydata?.name, }); // generate json-ld structured data events const validevents = eventswithads.filter(iseventsummaryresponsedto); const structureddata = validevents.length &amp;gt; 0 ? generateitemliststructureddata( validevents, categorydata ? `${categorydata.name} ${filters.place}` : `esdeveniments ${filters.place}` ) : null; return ( &amp;lt;&amp;gt; {/* json-ld structured data */} {structureddata &amp;amp;&amp;amp; ( &amp;lt;script id={`events-${filters.place}-${filters.bydate}-${filters.category}`} type="application/ld+json" strategy="afterinteractive" dangerouslysetinnerhtml={{ __html: json.stringify(structureddata), }} /&amp;gt; )} &amp;lt;hybrideventslist initialevents={eventswithads} pagedata={pagedata} placetypelabel={placetypeandlabel} place={filters.place} category={filters.category} date={filters.bydate} serverhasmore={!eventsresponse?.last} noeventsfound={noeventsfound} /&amp;gt; &amp;lt;clientinteractivelayer categories={categories} placetypelabel={placetypeandlabel} /&amp;gt; &amp;lt;/&amp;gt; ); }&lt;/file&gt;&lt;file name="app/e/[eventid]/eventclient.tsx"&gt;"use client"; import { usestate, useeffect } "react"; import { usesearchparams } "next/navigation"; // import useonscreen "components/hooks/useonscreen"; import { sendgoogleevent } "@utils/analytics"; import type { eventdetailresponsedto } "types/api/event"; import eventnotifications "./components/eventnotifications"; import eventheader "./components/eventheader"; import eventcategories "./components/eventcategories"; import eventdescription "./components/eventdescription"; import eventcalendar "./components/eventcalendar"; import eventweather "./components/eventweather"; import eventlocation "./components/eventlocation"; // import { useeventmodals } "./hooks/useeventmodals"; // import eventmodals "./components/eventmodals"; import { // pencilicon, // informationcircleicon infoicon, globealticon webicon, speakerphoneicon, } "@heroicons/react/outline"; import adarticle "components/ui/adarticle"; // const tooltip = dynamic(() =&amp;gt; import("components/ui/tooltip"), { // ssr: false, // }); // helper function calculate time event function calculatetimeuntil(startdate: string, enddate?: string): string { const = new date(); const eventstart = new date(startdate); const eventend = enddate ? new date(enddate) : null; // event already ended (eventend &amp;amp;&amp;amp; &amp;gt; eventend) { return "l'esdeveniment ha finalitzat"; } // event currently ongoing (eventend &amp;amp;&amp;amp; &amp;gt;= eventstart &amp;amp;&amp;amp; &amp;lt;= eventend) { const timediff = eventend.gettime() - now.gettime(); const days = math.floor(timediff / (1000 * 60 * 60 * 24)); const hours = math.floor( (timediff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60) ); (days &amp;gt; 0) { return `acaba en ${days} dies`; } else (hours &amp;gt; 0) { return `acaba en ${hours} hores`; } else { return "l'esdeveniment acaba aviat"; } } // event started yet const timediff = eventstart.gettime() - now.gettime(); (timediff &amp;lt;= 0) { return "l'esdeveniment ara"; } const days = math.floor(timediff / (1000 * 60 * 60 * 24)); const hours = math.floor( (timediff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60) ); (days &amp;gt; 0) { return `comena en ${days} dies`; } else (hours &amp;gt; 0) { return `comena en ${hours} hores`; } else { return "l'esdeveniment avui"; } } export default function eventclient({ event, }: { event: eventdetailresponsedto; }) { // const editmodalref = useref&amp;lt;htmldivelement&amp;gt;(null); // const iseditmodalvisible = useonscreen( // editmodalref react.refobject&amp;lt;element&amp;gt;, // { // freezeoncevisible: true, // } // ); const searchparams = usesearchparams() ?? new urlsearchparams(); const newevent = searchparams.get("newevent"); const edit_suggested = searchparams.get("edit_suggested") === "true"; const [showthankyoubanner, setshowthankyoubanner] = usestate(edit_suggested); // const { // openmodal, // setopenmodal, // opendeletereasonmodal, // setopenmodaldeletereasonmodal, // reasontodelete, // setreasontodelete, // onsenddeletereason, // onremove, // } = useeventmodals(); useeffect(() =&amp;gt; { sendgoogleevent("view_event_page", {}); }, []); const slug = event.slug ?? ""; const title = event.title ?? ""; const cityname = event.city?.name || ""; const regionname = event.region?.name || ""; return ( &amp;lt;&amp;gt; &amp;lt;eventnotifications newevent={!!newevent} title={title} slug={slug} showthankyoubanner={!!showthankyoubanner} setshowthankyoubanner={setshowthankyoubanner} /&amp;gt; {/* event header */} &amp;lt;eventheader title={title} /&amp;gt; {/* event calendar */} &amp;lt;eventcalendar event={event} /&amp;gt; {/* location map toggle */} &amp;lt;eventlocation location={event.location} cityname={cityname} regionname={regionname} /&amp;gt; {/* event categories - better positioned essential info */} &amp;lt;eventcategories categories={event.categories} place={event.region.slug} /&amp;gt; {/* ad section */} &amp;lt;div classname="w-full h-full flex justify-center items-start px-4 min-h-[250px] gap-2"&amp;gt; &amp;lt;speakerphoneicon classname="w-5 h-5 mt-1" /&amp;gt; &amp;lt;div classname="w-11/12 flex flex-col gap-4"&amp;gt; &amp;lt;h2&amp;gt;contingut patrocinat&amp;lt;/h2&amp;gt; &amp;lt;adarticle slot="9643657007" /&amp;gt; &amp;lt;/div&amp;gt; &amp;lt;/div&amp;gt; {/* description */} &amp;lt;eventdescription description={event.description} locationvalue={event.city.slug || event.region.slug} location={cityname || regionname} /&amp;gt; {/* weather */} &amp;lt;div classname="w-full"&amp;gt; &amp;lt;eventweather weather={event.weather} /&amp;gt; &amp;lt;/div&amp;gt; {/* event details section */} &amp;lt;div classname="w-full flex justify-center items-start gap-2 px-4"&amp;gt; &amp;lt;webicon classname="w-5 h-5 mt-1" /&amp;gt; &amp;lt;div classname="w-11/12 flex flex-col gap-4"&amp;gt; &amp;lt;h2&amp;gt;detalls de l&amp;amp;apos;esdeveniment&amp;lt;/h2&amp;gt; &amp;lt;div classname="flex justify-start items-center gap-2"&amp;gt; &amp;lt;div classname="flex items-center gap-1 font-normal"&amp;gt; {calculatetimeuntil(event.startdate, event.enddate)} &amp;lt;/div&amp;gt; &amp;lt;/div&amp;gt; {event.duration &amp;amp;&amp;amp; ( &amp;lt;div classname="flex justify-start items-center gap-2"&amp;gt; &amp;lt;div classname="flex items-center gap-1 font-normal"&amp;gt; durada aproximada: {event.duration} &amp;lt;/div&amp;gt; &amp;lt;/div&amp;gt; )} {event.url &amp;amp;&amp;amp; ( &amp;lt;div classname="font-bold"&amp;gt; enlla l&amp;amp;apos;esdeveniment: classname="text-primary hover:underline font-normal ml-1" href={event.url} target="_blank" rel="noreferrer" &amp;gt; {event.title} &amp;lt;/div&amp;gt; )} &amp;lt;/div&amp;gt; &amp;lt;/div&amp;gt; {/* edit button section */} {/* &amp;lt;div classname="w-full flex justify-center items-start gap-2 px-4"&amp;gt; &amp;lt;pencilicon classname="w-5 h-5 mt-1" /&amp;gt; &amp;lt;div classname="w-11/12 flex flex-col gap-4"&amp;gt; &amp;lt;h2&amp;gt;suggerir un canvi&amp;lt;/h2&amp;gt; {iseditmodalvisible &amp;amp;&amp;amp; ( &amp;lt;div classname="w-11/12 flex justify-start items-center gap-2 cursor-pointer"&amp;gt; &amp;lt;div onclick={() =&amp;gt; { setopenmodal(true); sendgoogleevent("open-change-modal", {}); }} classname="gap-2 ease-in-out duration-300 border-whitecorp hover:border-blackcorp" &amp;gt; &amp;lt;p classname="font-medium flex items-center"&amp;gt;editar&amp;lt;/p&amp;gt; &amp;lt;/div&amp;gt; &amp;lt;infoicon classname="w-5 h-5" data-tooltip-id="edit-button" /&amp;gt; &amp;lt;tooltip id="edit-button"&amp;gt; si desprs de veure la informaci de l&amp;amp;apos;esdeveniment, &amp;lt;br /&amp;gt; veus que hi ha alguna dada erronia vols ampliar la &amp;lt;br /&amp;gt; informaci, pots fer-ho al segent enlla. revisarem el &amp;lt;br /&amp;gt; canvi actualitzarem l&amp;amp;apos;informaci. &amp;lt;/tooltip&amp;gt; &amp;lt;/div&amp;gt; )} &amp;lt;/div&amp;gt; &amp;lt;/div&amp;gt; */} {/* edit modal */} {/* &amp;lt;div ref={editmodalref} classname="w-full"&amp;gt; {iseditmodalvisible &amp;amp;&amp;amp; ( &amp;lt;eventmodals openmodal={openmodal} setopenmodal={setopenmodal} opendeletereasonmodal={opendeletereasonmodal} setopenmodaldeletereasonmodal={setopenmodaldeletereasonmodal} reasontodelete={reasontodelete} setreasontodelete={setreasontodelete} onsenddeletereason={() =&amp;gt; onsenddeletereason(string(event.id), event.title) } onremove={onremove} slug={event.slug} /&amp;gt; )} &amp;lt;/div&amp;gt; */} &amp;lt;/&amp;gt; ); }&lt;/file&gt;&lt;file name="app/e/[eventid]/page.tsx"&gt;import { generatejsondata } "@utils/helpers"; import { fetcheventbyid } "@lib/api/events"; import { eventdetailresponsedto } "types/api/event"; import { metadata } "next"; import { siteurl } "@config/index"; import { generateeventmetadata } "../../../lib/meta"; import { extractuuidfromslug } "@utils/string-helpers"; import { headers } "next/headers"; import script "next/script"; import eventmedia "./components/eventmedia"; import eventsharebar "./components/eventsharebar"; import eventclient "./eventclient"; import noeventfound "components/ui/common/noeventfound"; import eventsaroundsection "@components/ui/eventsaround/eventsaroundsection"; import { speakerphoneicon } "@heroicons/react/outline"; import adarticle "components/ui/adarticle"; // helper: metadata generation export async function generatemetadata(props: { params: promise&amp;lt;{ eventid: string }&amp;gt;; }): promise&amp;lt;metadata&amp;gt; { const slug = (await props.params).eventid; const uuid = extractuuidfromslug(slug); const event = await fetcheventbyid(uuid); (!event) return { title: event found" }; return generateeventmetadata(event, `${siteurl}/e/${slug}`); } // main page component export default async function eventpage({ params, }: { params: promise&amp;lt;{ eventid: string }&amp;gt;; }) { const slug = (await params).eventid; const uuid = extractuuidfromslug(slug); // read nonce middleware headers const headerslist = await headers(); const nonce = headerslist.get("x-nonce") || ""; const event: eventdetailresponsedto | null = await fetcheventbyid(uuid); (!event) return &amp;lt;noeventfound /&amp;gt;; (event.title === "cancelled") return &amp;lt;noeventfound /&amp;gt;; const eventslug = event?.slug ?? ""; const title = event?.title ?? ""; const cityname = event.city?.name || ""; const regionname = event.region?.name || ""; const eventdatestring = event.enddate ? `del ${event.startdate} al ${event.enddate}` : `${event.startdate}`; const jsondata = generatejsondata({ ...event }); // generate json-ld related events (server-side seo) const relatedeventsjsondata = event.relatedevents &amp;amp;&amp;amp; event.relatedevents.length &amp;gt; 0 ? { "@id": `${siteurl}#itemlist-${title ?.tolowercase() .replace(/\s+/g, "-")}`, "@context": "https://schema.org", "@type": "itemlist", name: "related events", numberofitems: event.relatedevents.length, itemlistelement: event.relatedevents .slice(0, 10) // limit performance .map((relatedevent, index) =&amp;gt; { try { return { "@type": "listitem", position: index + 1, item: generatejsondata(relatedevent), }; } catch (err) { console.error( "error generating json-ld related event:", relatedevent.id, err ); return null; } }) .filter(boolean), } : null; return ( &amp;lt;&amp;gt; {/* main event json-ld */} &amp;lt;script id={event.id ? string(event.id) : undefined} type="application/ld+json" strategy="afterinteractive" nonce={nonce} dangerouslysetinnerhtml={{ __html: json.stringify(jsondata) }} /&amp;gt; {/* related events json-ld */} {relatedeventsjsondata &amp;amp;&amp;amp; ( &amp;lt;script id={`related-events-${event.id}`} type="application/ld+json" strategy="afterinteractive" nonce={nonce} dangerouslysetinnerhtml={{ __html: json.stringify(relatedeventsjsondata), }} /&amp;gt; )} &amp;lt;div classname="w-full flex justify-center bg-whitecorp pb-10"&amp;gt; &amp;lt;div classname="w-full flex flex-col justify-center items-center gap-4 sm:w-[520px] md:w-[520px] lg:w-[520px] min-w-0"&amp;gt; &amp;lt;article classname="w-full flex flex-col justify-center items-start gap-8"&amp;gt; &amp;lt;div classname="w-full flex flex-col justify-center items-start gap-4"&amp;gt; &amp;lt;eventmedia event={event} title={title} /&amp;gt; &amp;lt;eventsharebar visits={event.visits} slug={eventslug} title={title} description={event.description} eventdatestring={eventdatestring} location={event.location} cityname={cityname} regionname={regionname} postalcode={event.city?.postalcode || ""} /&amp;gt; &amp;lt;/div&amp;gt; &amp;lt;eventclient event={event} /&amp;gt; {/* related events - server-side rendered seo */} {event.relatedevents &amp;amp;&amp;amp; event.relatedevents.length &amp;gt; 0 &amp;amp;&amp;amp; ( &amp;lt;eventsaroundsection events={event.relatedevents} title="esdeveniments relacionats" nonce={nonce} /&amp;gt; )} {/* final ad section */} &amp;lt;div classname="w-full h-full flex justify-center items-start px-4 min-h-[250px] gap-2"&amp;gt; &amp;lt;speakerphoneicon classname="w-5 h-5 mt-1" /&amp;gt; &amp;lt;div classname="w-11/12 flex flex-col gap-4"&amp;gt; &amp;lt;h2&amp;gt;contingut patrocinat&amp;lt;/h2&amp;gt; &amp;lt;adarticle slot="9643657007" /&amp;gt; &amp;lt;/div&amp;gt; &amp;lt;/div&amp;gt; &amp;lt;/article&amp;gt; &amp;lt;/div&amp;gt; &amp;lt;/div&amp;gt; &amp;lt;/&amp;gt; ); } export const revalidate = 1800;&lt;/file&gt;&lt;file name="app/e/[eventid]/components/eventcalendar.tsx"&gt;import { calendaricon } "@heroicons/react/outline"; import { siteurl } "@config/index"; import { getformatteddate } "@utils/helpers"; import type { eventcalendarprops } "types/event"; import addtocalendar "@components/ui/addtocalendar"; export default function eventcalendar({ event }: eventcalendarprops) { // extract needed fields const { title, description, location, city, region, startdate, enddate, slug, starttime, endtime, } = event; const { formattedstart, formattedend, nameday } = getformatteddate( startdate, enddate ); const eventdate = formattedend ? `del ${formattedstart} al ${formattedend}` : `${nameday}, ${formattedstart}`; return ( &amp;lt;div classname="w-full flex justify-center items-start gap-2 px-4"&amp;gt; &amp;lt;calendaricon classname="w-5 h-5 mt-1" /&amp;gt; &amp;lt;div classname="w-11/12 flex flex-col gap-4"&amp;gt; &amp;lt;h2&amp;gt;data hora&amp;lt;/h2&amp;gt; &amp;lt;div classname="w-full flex flex-col gap-4"&amp;gt; &amp;lt;p&amp;gt;{eventdate}&amp;lt;/p&amp;gt; &amp;lt;p classname="capitalize"&amp;gt; {!starttime || starttime === "00:00" ? "consultar horaris" : `${starttime} - ${endtime || ""}`} &amp;lt;/p&amp;gt; &amp;lt;/div&amp;gt; &amp;lt;addtocalendar title={title} description={description} location={`${location}, ${city?.name || ""}, ${region?.name || ""}, ${ city?.postalcode || "" }`} startdate={startdate} enddate={enddate} canonical={`${siteurl}/e/${slug}`} /&amp;gt; &amp;lt;/div&amp;gt; &amp;lt;/div&amp;gt; ); }&lt;/file&gt;&lt;file name="app/e/[eventid]/components/eventcategories.tsx"&gt;"use client"; import react "react"; import link "next/link"; import { tagicon } "@heroicons/react/outline"; import type { eventcategoriesprops } "types/event"; const eventcategories: react.fc&amp;lt;eventcategoriesprops&amp;gt; = ({ categories, place, }) =&amp;gt; { (!categories || categories.length === 0) return null; return ( &amp;lt;div classname="w-full flex justify-center items-start gap-2 px-4"&amp;gt; &amp;lt;tagicon classname="h-5 w-5 mt-1 text-blackcorp flex-shrink-0" aria-hidden="true" /&amp;gt; &amp;lt;div classname="w-11/12 flex flex-col gap-4"&amp;gt; &amp;lt;h2 classname="text-blackcorp font-semibold"&amp;gt;categories&amp;lt;/h2&amp;gt; &amp;lt;div classname="flex flex-wrap gap-3"&amp;gt; {categories.map((category) =&amp;gt; ( &amp;lt;link key={category.id} href={`/${place}/${category.slug}`} classname="text-blackcorp bg-whitecorp hover:bg-primary hover:border-whitecorp hover:text-whitecorp border-blackcorp rounded-xl py-2 px-4 ease-in-out duration-300 border focus:outline-none font-barlow italic uppercase font-semibold tracking-wide text-sm" &amp;gt; {category.name} &amp;lt;/link&amp;gt; ))} &amp;lt;/div&amp;gt; &amp;lt;/div&amp;gt; &amp;lt;/div&amp;gt; ); }; export default eventcategories;&lt;/file&gt;&lt;file name="app/e/[eventid]/components/eventdescription.tsx"&gt;"use client"; import description "@components/ui/common/description"; import react "react"; import type { eventdescriptionprops } "types/event"; const eventdescription: react.fc&amp;lt;eventdescriptionprops&amp;gt; = ({ description, location, locationvalue, }) =&amp;gt; { return ( &amp;lt;div classname="w-full flex justify-center items-start gap-2 px-4"&amp;gt; &amp;lt;div classname="max-w-none text-gray-800"&amp;gt; &amp;lt;description description={description} location={location} locationvalue={locationvalue} /&amp;gt; &amp;lt;/div&amp;gt; &amp;lt;/div&amp;gt; ); }; export default eventdescription;&lt;/file&gt;&lt;file name="app/e/[eventid]/components/eventheader.tsx"&gt;import react "react"; import type { eventheaderprops } "types/event"; const eventheader: react.fc&amp;lt;eventheaderprops&amp;gt; = ({ title }) =&amp;gt; { return ( &amp;lt;div classname="w-full flex flex-col justify-start items-start gap-2 px-4"&amp;gt; &amp;lt;h1 classname="text-2xl font-bold uppercase"&amp;gt;{title}&amp;lt;/h1&amp;gt; &amp;lt;/div&amp;gt; );